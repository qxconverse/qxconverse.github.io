<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="总结,">










<meta name="description" content="2018网易实习总结6-211.领取电脑，配置了邮箱和popo 电脑账户：qinxue，密码：111220Qx! rd邮箱：qinxue@rd.netease.com，密码：111220Qinxue! corp邮箱：qinxue@corp.netease.com，密码：111220Qx wifi：电脑账户与密码 gitlab账号：https://gitlab.corp.youdao.com/：qi">
<meta name="keywords" content="总结">
<meta property="og:type" content="article">
<meta property="og:title" content="2018网易实习总结">
<meta property="og:url" content="http://yoursite.com/2019/07/07/2018网易实习总结/index.html">
<meta property="og:site_name" content="Xxqin&#39;s Blog">
<meta property="og:description" content="2018网易实习总结6-211.领取电脑，配置了邮箱和popo 电脑账户：qinxue，密码：111220Qx! rd邮箱：qinxue@rd.netease.com，密码：111220Qinxue! corp邮箱：qinxue@corp.netease.com，密码：111220Qx wifi：电脑账户与密码 gitlab账号：https://gitlab.corp.youdao.com/：qi">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://pavgwqw80.bkt.clouddn.com/blog/180628/DE7Gl1mgK2.png?imageslim&ynotemdtimestamp=1562429270807">
<meta property="og:image" content="http://pavgwqw80.bkt.clouddn.com/blog/180628/5LkjiBH4eH.png?imageslim&ynotemdtimestamp=1562429270807">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79ly1fsvcq2usucj31hs0tu7c5.jpg">
<meta property="og:updated_time" content="2019-07-07T06:17:50.227Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2018网易实习总结">
<meta name="twitter:description" content="2018网易实习总结6-211.领取电脑，配置了邮箱和popo 电脑账户：qinxue，密码：111220Qx! rd邮箱：qinxue@rd.netease.com，密码：111220Qinxue! corp邮箱：qinxue@corp.netease.com，密码：111220Qx wifi：电脑账户与密码 gitlab账号：https://gitlab.corp.youdao.com/：qi">
<meta name="twitter:image" content="http://pavgwqw80.bkt.clouddn.com/blog/180628/DE7Gl1mgK2.png?imageslim&ynotemdtimestamp=1562429270807">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/07/07/2018网易实习总结/">





  <title>2018网易实习总结 | Xxqin's Blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xxqin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/07/2018网易实习总结/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qin xue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xxqin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2018网易实习总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-07T12:09:52+08:00">
                2019-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">代码</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="2018网易实习总结"><a href="#2018网易实习总结" class="headerlink" title="2018网易实习总结"></a>2018网易实习总结</h3><h4 id="6-21"><a href="#6-21" class="headerlink" title="6-21"></a>6-21</h4><p>1.领取电脑，配置了邮箱和popo</p>
<p><strong>电脑账户：qinxue，密码：111220Qx!</strong></p>
<p><strong>rd邮箱：<a href="mailto:qinxue@rd.netease.com" target="_blank" rel="noopener">qinxue@rd.netease.com</a>，密码：111220Qinxue!</strong></p>
<p><strong>corp邮箱：<a href="mailto:qinxue@corp.netease.com" target="_blank" rel="noopener">qinxue@corp.netease.com</a>，密码：111220Qx</strong></p>
<p><strong>wifi：电脑账户与密码</strong></p>
<p><strong>gitlab账号：</strong><a href="https://gitlab.corp.youdao.com/" target="_blank" rel="noopener"><strong>https://gitlab.corp.youdao.com/</strong></a><strong>：qinxue，111220Qinxue!</strong></p>
<p><strong>popo：corp邮箱和密码</strong></p>
<p>2.安装常用软件，比如sublime等</p>
<p>3.安装jdk，intelliJ idea，xshell，git，tortoise svn，navicat等</p>
<p>svn、gitlab等都是rd账号密码。</p>
<p>人工翻译的两个测试账号和相关网址</p>
<p><a href="https://at-test1.youdao.com/" target="_blank" rel="noopener">https://at-test1.youdao.com/</a></p>
<p><a href="https://at-test1.youdao.com/ds" target="_blank" rel="noopener">https://at-test1.youdao.com/ds</a></p>
<p><a href="https://at-test1.youdao.com/translator.z" target="_blank" rel="noopener">https://at-test1.youdao.com/translator.z</a></p>
<p><a href="mailto:fanyiceshi1@163.com" target="_blank" rel="noopener">fanyiceshi1@163.com</a></p>
<p>译员账号：<a href="mailto:fanyiceshi2@163.com" target="_blank" rel="noopener">fanyiceshi2@163.com</a></p>
<p>对于已有的项目（比如从github上clone的项目），在idea中使用“打开”打开即可。</p>
<h4 id="6-22"><a href="#6-22" class="headerlink" title="6-22"></a>6-22</h4><p>9点半到公司，人都好少。。。</p>
<p>今天继续熟悉产品，熟悉代码。</p>
<p>打印机安装和使用地址：\10.238.14.8</p>
<p>定时任务相关：使用Executors.newScheduledThreadPool()方法</p>
<p>学习《Java并发编程实战》的第四章</p>
<p>了解微服务框架spring cloud</p>
<h4 id="6-23"><a href="#6-23" class="headerlink" title="6-23"></a>6-23</h4><p>今天主要是来公司蹭饭的，顺便搞些自己的东西</p>
<p>昨天照着<a href="https://blog.csdn.net/forezp/article/details/69696915上面学习SpringCloud中的服务的注册与发现（Eureka），没有实现成功，今天又试了一次，可以了。" target="_blank" rel="noopener">https://blog.csdn.net/forezp/article/details/69696915上面学习SpringCloud中的服务的注册与发现（Eureka），没有实现成功，今天又试了一次，可以了。</a></p>
<h4 id="6-25"><a href="#6-25" class="headerlink" title="6-25"></a>6-25</h4><p>了解道：hts-service（人工翻译基础服务，如：计算订单超时、短信、邮件服务、消息中间件、操作记录等）的项目结构。</p>
<h4 id="6-26"><a href="#6-26" class="headerlink" title="6-26"></a>6-26</h4><p>暂时先不看微服务的部分。学习官网的web部分的代码，需要从<code>svn co</code>下来。</p>
<p>关于svn的操作：先新建一个文件夹，然后右击相关的checkout操作。</p>
<p>学习<a href="https://skyao.gitbooks.io/learning-microservice/content/" target="_blank" rel="noopener">微服务</a>相关的知识</p>
<h4 id="6-27"><a href="#6-27" class="headerlink" title="6-27"></a>6-27</h4><p>译后编辑的主要框架为SpringCloud和RabbitMQ（消息队列）</p>
<p>安装Mysql以便后面的学习需要</p>
<h4 id="6-28"><a href="#6-28" class="headerlink" title="6-28"></a>6-28</h4><p>在实践netty第二章时，需要运行echo服务器和客户端。</p>
<p>在命令行窗口执行<code>mvn exec:java</code>，可能会报错：找不到类。原因是没有生成对应的class文件，所以需要首先在idea中运行一次对应的主类。</p>
<p><img src="http://pavgwqw80.bkt.clouddn.com/blog/180628/DE7Gl1mgK2.png?imageslim&amp;ynotemdtimestamp=1562429270807" alt="mark"></p>
<p><img src="http://pavgwqw80.bkt.clouddn.com/blog/180628/5LkjiBH4eH.png?imageslim&amp;ynotemdtimestamp=1562429270807" alt="mark"></p>
<p>项目中使用到了Apache Ivy进行项目依赖管理，Apache Ivy是一个优秀的管理（记录、跟踪、解析和报告）项目依赖的工具，可与Apache Ant紧密集成。</p>
<p>本地中没有安装ant和ivy，因为比较麻烦，所以本地只用来写代码等。因此需要单独把一些jar包拷贝到本地项目中，并配置classpath路径。否则的话，ivy会像maven一样，自动下载依赖包的。</p>
<p>主要做2件事，一个是标志src文件，一个是加入对应的jar包目录。</p>
<p>ivy.xml 文件中列举了项目的所有依赖项。</p>
<p>大概如下：常用的有info、conf、dependency等标签，conf标签很重要，它对应一组依赖的jar。exclude标签应该指的是排除某个模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;info organisation=&quot;outfox&quot; module=&quot;atranslate&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;configurations&gt;</span><br><span class="line">    &lt;conf name=&quot;dev&quot; visibility=&quot;private&quot; description=&quot;test&quot; /&gt;</span><br><span class="line">&lt;/configurations&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!-- outfox libs --&gt;</span><br><span class="line">    &lt;dependency org=&quot;outfox&quot; name=&quot;insight-hts&quot; rev=&quot;1.9.613192&quot; conf=&quot;dev-&gt;core&quot;&gt;</span><br><span class="line">        &lt;exclude module=&quot;httpclient-om&quot; /&gt;</span><br><span class="line">        &lt;exclude module=&quot;slf4j&quot; /&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>项目中还有一些配置文件，比如filter.properties等，里面主要定义一些变量的值</p>
<p>config中包含有的配置文件</p>
<ul>
<li>account.xml 存放zk的配置和一些账号系统的配置</li>
<li>dubbo.properties dubbo的配置</li>
<li>logback.xml 日志配置</li>
<li>omap-ocookie.xml ？</li>
<li>rabbitap.properties</li>
<li>uad-client.conf ？</li>
<li>user.properties</li>
<li>vaquero_at_web.xml ？</li>
</ul>
<p>在xml文件中，可以引入某个properties文件，需要引用里面的变量的值，可以使用<code>${xxx}</code>来实现。</p>
<p><code>config/server/provider.xml</code>中存放的是各种通过bean方式配置的server和storage，其中server相当于之前接触到的service，而storage相当于之前接触的dao，不同的是，之前的项目中，service和dao放在一个项目中，而这里是放在了两个项目中，当前项目只提供server，而storage放在了另外一个基础组件的项目中（hts-component），更深的是，基础组件项目的底层还有一个项目，存放的是一些抽象的服务，比如泛型功能（insight）。在两个底层的项目中，数据库的操作则是通过jdbc来完成的。</p>
<p><code>config/server/configStorageServer.xml</code>类似于上面</p>
<p>在调用某些方法的时候使用rpc来实现，web后台和分单系统后台是不同的项目。但是它们都与server端（里面提供dubbo服务，这个可以看做是另外一个项目）进行rpc。</p>
<p><code>web/WEB-INF/servletConfig.web.xml</code>里面存放的主要是storage、logic、controller和request mapping的配置</p>
<p>目前公司使用的是resin-4.0.35，Resin是CAUCHO公司的产品，是一个非常流行的application server，对servlet和JSP提供了良好的支持。同类产品是Tomcat和JBoss等容器。</p>
<p>resin比较适合在集群上使用。</p>
<p>resin文件夹里面的结构大致如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 qinxue]$ cd resin-4.0.35</span><br><span class="line">[qinxue@nc060 resin-4.0.35]$ ll</span><br><span class="line">total 76</span><br><span class="line">-rw-r--r-- 1 qinxue kaiwoo   78 Jun 14 11:24 agent_black_list</span><br><span class="line">-rw-r--r-- 1 qinxue kaiwoo   78 Jun 27 16:42 agent_black_list.tmp</span><br><span class="line">-rw-r--r-- 1 qinxue kaiwoo  604 Jun 14 02:24 agent_white_list</span><br><span class="line">-rw-r--r-- 1 qinxue kaiwoo  604 Jun 27 16:42 agent_white_list.tmp</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 app-inf</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Nov 13  2017 bin</span><br><span class="line">drwxr-xr-x 4 qinxue kaiwoo 4096 Jun 27 16:43 conf</span><br><span class="line">drwxr-xr-x 5 qinxue kaiwoo 4096 Apr 20  2016 doc</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 endorsed</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 lib</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 libexec64</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Jun 27 16:44 log</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Jun 27 16:45 logs</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 project-jars</span><br><span class="line">drwxr-xr-x 3 qinxue kaiwoo 4096 Nov  6  2017 resin-data</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 resin-inf</span><br><span class="line">drwxr-xr-x 3 qinxue kaiwoo 4096 Nov  6  2017 watchdog-data</span><br><span class="line">drwxr-xr-x 2 qinxue kaiwoo 4096 Apr 20  2016 webapp-jars</span><br><span class="line">drwxr-xr-x 3 qinxue kaiwoo 4096 Jun 27 16:44 webapps</span><br></pre></td></tr></table></figure>
<p>部署的时候，需要修改<code>conf/resin.xml</code>文件中的某些配置，watchdog和http port。 项目的需要，新建3个文件夹，tmp和NosTemp和logTest</p>
<h4 id="6-29"><a href="#6-29" class="headerlink" title="6-29"></a>6-29</h4><p>在win中，<code>netstat –ano</code>可以查看所有进程，查询指定某个端口号可以<code>netstat -ano|findstr &quot;8080&quot;</code></p>
<p>通过<code>tasklist</code>或<code>tasklist|findstr PID</code>可以查看所有的进程</p>
<p>通过<code>taskkill /f /t /im 进程名称</code>可以杀死进程</p>
<p>在linux中使用ll指令更好些，可以查看到所有的文件/文件夹和相关的属性。</p>
<p>关于打包的指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//打包 tar</span><br><span class="line">tar -cvf text.tar * //-v表示进度，text.tar是压缩文件名，*表示所有文件</span><br><span class="line">//解压</span><br><span class="line">tar -xvf text.tar</span><br><span class="line">//压缩 gzip</span><br><span class="line">gzip text.tar</span><br><span class="line">//解压</span><br><span class="line">gzip -d xxx.tar.gz</span><br><span class="line">//比较实用的</span><br><span class="line">tar -zcvf text.tar.gz * //打包</span><br><span class="line">tar -zxvf text.tar.gz //解压</span><br><span class="line">tar -zxvf text.tar.gz -c text/  //解压到指定路径</span><br></pre></td></tr></table></figure>
<p>查看某个文件的尾部<code>tail -f 2018-06-27.0.log</code></p>
<p>启动官网web或是分单系统，采用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ant clean</span><br><span class="line">ant restart-resin</span><br></pre></td></tr></table></figure>
<p><code>web.xml</code>中Filter，Listener，Servlet的区别：</p>
<p>Servlet是基本的服务端程序，他来自接口Servlet，接口中有方法service。</p>
<p>Listener是监听器，用于监听Servlet，他是基于观察者模式的，他的核心接口是ServletContextListener，继承自EventListener。</p>
<p>Filter是过滤器，用于过滤到servlet的request，它使用户可以改变一个request和修改一个response。Filter 不是一个servlet，它不能产生一个response，它能够在一个request到达servlet之前预处理request，也可以在离开servlet时处理response。换种说法，filter其实是一个“servlet chaining”(servlet 链)。</p>
<p>如果一个请求，同时调用到这三个，则执行顺序是：Listener，Filter，Servlet。</p>
<h4 id="6-30"><a href="#6-30" class="headerlink" title="6-30"></a>6-30</h4><p>今天把项目也搞到mac上，对于放在gitlab上的代码，使用https的方式来clone，这样就省去了配置ssh的私钥和公钥的步骤。说白了，只要涉及到ssh协议的传输，那么一定会需要公钥和私钥的，所以，gitlab相关的git操作和连接远程服务器都要用。</p>
<p>对于svn上的项目，就更简单了，因为mac自带svn，所以直接使用svn的命令checkout项目，具体的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout https://dev.corp.youdao.com/svn/outfox/incubator/rengong/milestones/2.0.6xx --username=qinxue --password=111220Qinxue! 2.0.6xx</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout https://dev.corp.youdao.com/svn/outfox/products/rssreader/module/insight/milestones/2.0-hts --username=qinxue --password=111220Qinxue! 2.0-hts</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout https://dev.corp.youdao.com/svn/outfox/incubator/rengong/milestones/hts_old_server --username=qinxue --password=111220Qinxue! hts_old_server</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout https://dev.corp.youdao.com/svn/outfox/incubator/rengong/branches/2.0.6_tongji_new --username=qinxue --password=111220Qinxue! 2.0.6_tongji_new</span><br></pre></td></tr></table></figure>
<h4 id="7-2（mac连接linux）"><a href="#7-2（mac连接linux）" class="headerlink" title="7-2（mac连接linux）"></a>7-2（mac连接linux）</h4><p>bean里面的refer值的是之前定义好的bean的名称</p>
<p>autowire在Spring里面是自动装配的意思</p>
<p>mac上terminal通过ssh连接远程linux服务器的方法：</p>
<ol>
<li>首先需要加入ssh的公钥和私钥，把两个文件拷贝到.ssh文件夹底下</li>
<li>通过命令<code>ssh-add .ssh/id_rsa_youdao</code>加入，输入密码后即可加入秘钥公钥</li>
<li>然后就可以通过命令<code>ssh -p 22 qinxue@nc060x.corp.youdao.com</code>连接上了</li>
</ol>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fsvcq2usucj31hs0tu7c5.jpg" alt=""></p>
<p>连接组账号<code>ssh -p 22 translator@nc060x.corp.youdao.com</code></p>
<p>连接远程数据库使用<code>mysql -h hostname -P port -u username -p</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h luna-ead-mysql.chq03dsmbyom.rds.cn-north-1.amazonaws.com.cn -P 3306 -u fanyi -p</span><br></pre></td></tr></table></figure></p>
<h4 id="7-3"><a href="#7-3" class="headerlink" title="7-3"></a>7-3</h4><p>在第一次任务中，总结的经验：</p>
<p>对于这样的一个很大的项目，首先进行一次模拟操作，看看网址，找到对应的方法。 然后在<code>servletConfig.web.xml</code>里面找到对应的Java类。并找到对应的方法（如果能够很熟悉地看出）。有时会出现的情况是，通过地址不能直接看出是哪个方法，比如弹框里面的表单提交。这时就要通过js文件来查看。</p>
<p>可以看到，对应的方法是：<code>requireModifyFileOrder</code>，然后再一步一步地挖代码。</p>
<p>关于部署：<code>svn up &amp;&amp; ant clean &amp;&amp; ant restart-resin</code></p>
<p>需要查看系统的日志：<code>cd /disk1/atranslate/serverLog</code>，选择具体的日志，即<code>tail -100 2018-07-03.0.log</code></p>
<h4 id="7-4"><a href="#7-4" class="headerlink" title="7-4"></a>7-4</h4><p>研究网站调用过程，即访问了哪些后台接口</p>
<p>了解dubbo和rpc/zookeeper</p>
<p>dubbo是一个高性能的、基于Java的开源RPC框架。</p>
<p>dubbo的架构如下图：</p>
<blockquote>
<p>Dubbo offers three key functionalities, which include interface based remote call, fault tolerance &amp; load balancing, and automatic service registration &amp; discovery.</p>
</blockquote>
<p>它的3个主要的功能是：<strong>基于接口的远程调用、容错和负载均衡、自动的服务注册和发现。</strong></p>
<p>项目中的<code>conf/server/provider.xml</code>文件解析：</p>
<p>数据库连接池的配置，典型的采用了spring的xml配置方式。</p>
<p>Server端暴露服务</p>
<p>需要创建服务接口，并实现该接口，在<code>src/core/atranslate.server.impl</code>里面，<strong>需要注意的是：RPC通信时需要编码和解码，所以接口中的参数、返回值需要支持序列化，即implements Serializable。</strong></p>
<p>因为很多服务实现中要用到storage相关的类，所以也要注入storage。总结：在某个类中需要哪些组件（比如某某storage、某某service等），就要去注入进去（在xml中配置）</p>
<p>关于storage的bean注入，注意的是，这些类都在hts-component中。具体实现的是一些基础的数据库操作。</p>
<h4 id="7-5"><a href="#7-5" class="headerlink" title="7-5"></a>7-5</h4><p>设计模式中观察者模式与监听模式的区别：</p>
<p>监听器模式：事件源经过事件的封装传给监听器，当事件源触发事件后，监听器接收到事件对象可以回调事件的方法</p>
<p>观察者模式：观察者(Observer)相当于事件监听者，被观察者(Observable)相当于事件源和事件，执行逻辑时通知observer即可触发oberver的update,同时可传被观察者和参数</p>
<p>具体参考：<a href="https://www.cnblogs.com/jackson-zhangjiang/p/7784694.html" target="_blank" rel="noopener">https://www.cnblogs.com/jackson-zhangjiang/p/7784694.html</a></p>
<p>关于过滤器和拦截器的区别：<a href="https://blog.csdn.net/xiaoyaotan_111/article/details/53817918" target="_blank" rel="noopener">https://blog.csdn.net/xiaoyaotan_111/article/details/53817918</a></p>
<p>需要使用spring mvc时，要加入以下的dependency：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.3.14.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>当需要使用<code>HttpServletRequest</code>等时，需要加入以下的依赖，其实就是servlet。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/servlet-api --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>filter依赖于servlet容器。在实现上基于函数回调，可以对几乎所有请求进行过滤，但是缺点是一个过滤器实例只能在容器初始化时调用一次。</p>
<p>拦截器依赖于web框架，在SpringMVC中就是依赖于SpringMVC框架。在实现上基于Java的反射机制，属于面向切面编程（AOP）的一种运用。</p>
<p>反映在代码配置中，filter是在web.xml里面配置的，而拦截器是在spring相关的配置中的。</p>
<p>Servlet的监听器Listener是实现了javax.servlet.ServletContextListener接口的服务器端程序，它和filter一样也是随web应用的启动而启动，只初始化一次，随web应用的停止而销毁。主要作用是：做一些初始化的内容添加工作、设置一些基本的内容、比如一些参数或者是一些固定的对象等等。例如利用监听器对数据库连接池DataSource的初始化。监听器对象可以在事情发生前、发生后可以做一些必要的处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void init() throws IOException &#123;</span><br><span class="line">        Runtime.getRuntime().addShutdownHook(new Thread() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>Runtime.getRuntime().addShutdownHook(shutdownHook);</code>这个方法的意思就是在jvm中增加一个关闭的钩子，当jvm关闭的时候，会执行系统中已经设置的所有通过方法addShutdownHook添加的钩子，当系统执行完这些钩子后，jvm才会关闭。所以这些钩子可以在jvm关闭的时候进行内存清理、对象销毁等操作。</p>
<p>此处用到了并发同步机制。关于java中的synchronized的知识点：<a href="https://blog.csdn.net/luoweifu/article/details/46613015" target="_blank" rel="noopener">https://blog.csdn.net/luoweifu/article/details/46613015</a> ，它是一个同步锁。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void close() &#123;</span><br><span class="line">        if (pw != null) &#123;</span><br><span class="line">            pw.close();</span><br><span class="line">            pw = null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>A. 无论synchronized关键字加在方法上还是对象上，如果它作用的对象是非静态的，则它取得的锁是对象；如果synchronized作用的对象是一个静态方法或一个类，则它取得的锁是对类，该类所有的对象同一把锁。</p>
<p>B. 每个对象只有一个锁（lock）与之相关联，谁拿到这个锁谁就可以运行它所控制的那段代码。</p>
<p>C. 实现同步是要很大的系统开销作为代价的，甚至可能造成死锁，所以尽量避免无谓的同步控制。</p>
<p>在发送邮件的类中，使用到了线程池，线程池的submit方法的参数为一个Runnable的类，该类为内部类。这样就实现了并发的邮件发送。</p>
<h4 id="7-6"><a href="#7-6" class="headerlink" title="7-6"></a>7-6</h4><p>在UserAmountHelper中的关于synchronized的使用。</p>
<p>项目中的短信服务，主要使用的是HttpClient类。关于它的介绍：<a href="https://blog.csdn.net/wangpeng047/article/details/19624529" target="_blank" rel="noopener">https://blog.csdn.net/wangpeng047/article/details/19624529</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private static ExecutorService threadPool = null;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">public void init() &#123;</span><br><span class="line">    ...</span><br><span class="line">    threadPool = Executors.newFixedThreadPool(poolSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">threadPool.submit(new SendSmsTask(translator, msg));</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ReentrantReadWriteLock允许多个读线程同时访问，但不允许写线程和读线程、写线程和写线程同时访问。相对于排他锁，提高了并发性。在实际应用中，大部分情况下对共享数据（如缓存）的访问都是读操作远多于写操作，这时ReentrantReadWriteLock能够提供比排他锁更好的并发性和吞吐量。具体参考：<a href="https://www.cnblogs.com/zaizhoumo/p/7782941.html" target="_blank" rel="noopener">https://www.cnblogs.com/zaizhoumo/p/7782941.html</a></p>
<p>ReentrantReadWriteLock支持以下功能：</p>
<p>1）支持公平和非公平的获取锁的方式；</p>
<p>2）支持可重入。读线程在获取了读锁后还可以获取读锁；写线程在获取了写锁之后既可以再次获取写锁又可以获取读锁；</p>
<p>3）还允许从写入锁降级为读取锁，其实现方式是：先获取写入锁，然后获取读取锁，最后释放写入锁。但是，从读取锁升级到写入锁是不允许的；</p>
<p>4）读取锁和写入锁都支持锁获取期间的中断；</p>
<p>5）Condition支持。仅写入锁提供了一个 Conditon 实现；读取锁不支持 Conditon ，readLock().newCondition() 会抛出 UnsupportedOperationException。 　　　　 </p>
<p>在TranslatorHelper中涉及到的并发。需要加锁来操作。</p>
<p>关于静态代码块 静态代码块:在java中使用static关键字声明的代码块。静态块用于初始化类，为类的属性初始化。每个静态代码块只会执行一次。由于JVM在加载类时会执行静态代码块，所以静态代码块先于主方法执行。如果类中包含多个静态代码块，那么将按照”先定义的代码先执行，后定义的代码后执行”。</p>
<p>执行顺序：静态代码块 &gt; mian方法 &gt; 构造代码块 &gt; 构造方法。 其中静态代码块只执行一次。构造代码块在每次创建对象是都会执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">try 尝试</span><br><span class="line">&#123;</span><br><span class="line">　　需要被检测异常的代码</span><br><span class="line">&#125;</span><br><span class="line">catch（异常类 变量）</span><br><span class="line">&#123;</span><br><span class="line">　　处理异常的代码</span><br><span class="line">&#125;</span><br><span class="line">catch（异常类 变量）</span><br><span class="line">&#123;</span><br><span class="line">　　处理异常的代码</span><br><span class="line">　　return; 退出整个方法，但finally依旧执行。</span><br><span class="line">　　System.exit(0); 退出java虚拟机，只有这种情况finally不会执行。</span><br><span class="line">&#125;</span><br><span class="line">finally 最终化</span><br><span class="line">&#123;</span><br><span class="line">　　一定会被执行的代码，除了上面提到的一种情况。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-9"><a href="#7-9" class="headerlink" title="7-9"></a>7-9</h4><p>如果改动涉及到服务端，那么就用translator的账号登陆，并且到2.0.6xx_server底下去<code>svn up &amp;&amp; ant clean &amp;&amp; ant install</code>，当然要先<code>/stopProvider.sh</code>等。</p>
<p>而如果不涉及到服务端，只是web，那么就登陆qinxue账号，并且到code底下，然后<code>svn sw ...</code>，切换到对应的分支，<code>svn up &amp;&amp; ant clean &amp;&amp; ant restart-resin</code>。</p>
<p>当需要改动js时，需要把模式从product设置成debug，而且在<code>default.properties</code>里面的compress改动为off。</p>
<p>如果A项目需要改动B项目里面的代码来实现功能：</p>
<ol>
<li>先改动B项目里面的代码并更新B项目</li>
<li><code>sh publish.sh</code>发布B项目，记住它的新的版本号</li>
<li>把新的版本号加入到A项目中的ivy.xml文件里面</li>
<li>通过<code>sz hts-component.jar</code>，把新打包好的B项目jar包导入到A项目中。</li>
<li>更新A项目并且重启A项目</li>
</ol>
<h4 id="7-10"><a href="#7-10" class="headerlink" title="7-10"></a>7-10</h4><p>看redis设计与实现</p>
<h4 id="7-11"><a href="#7-11" class="headerlink" title="7-11"></a>7-11</h4><p>mvc中关于文件上传：</p>
<p>首先需要引入spring mvc的maven依赖。为了使用FileItem，需要添加upload-file的maven依赖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.youdao&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;multi-files-upload&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;packaging&gt;war&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">  &lt;name&gt;multi-files-upload Maven Webapp&lt;/name&gt;</span><br><span class="line">  &lt;!-- FIXME change it to the project&apos;s website --&gt;</span><br><span class="line">  &lt;url&gt;http://www.example.com&lt;/url&gt;</span><br><span class="line"></span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;</span><br><span class="line">    &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;</span><br><span class="line">  &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.3.2.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.7.25&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/javax.servlet/servlet-api --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.3.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.json/json --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.json&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;json&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;20160810&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.9.5&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>在spring-mvc的配置中，要加上下面的bean，否则报错<code>org.apache.catalina.connector.RequestFacade cannot be cast to org.springframework.web.multipart.MultipartHttpServletRequest</code>，大概就是无法把reques转换成MultipartHttpServletRequest吧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;maxUploadSize&quot; value=&quot;10485760&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;maxInMemorySize&quot; value=&quot;40960&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>注意JSON的使用，需要添加相应的maven依赖。</p>
<p>注意在spring mvc中想要返回json数据，方法之一就是使用<code>@ResponseBody</code>注解。使用spring mvc的默认配置就可以返回json了，不过需要添加jackson的相关依赖。</p>
<p>想要使用log4j输出，需要在web.xml中加入以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;context-param&gt;</span><br><span class="line">  &lt;param-name&gt;log4jConfigLocation&lt;/param-name&gt;</span><br><span class="line">  &lt;param-value&gt;/WEB-INF/config/log4j.properties&lt;/param-value&gt;</span><br><span class="line">&lt;/context-param&gt;</span><br><span class="line">&lt;listener&gt;</span><br><span class="line">  &lt;listener-class&gt;org.springframework.web.util.Log4jConfigListener&lt;/listener-class&gt;</span><br><span class="line">&lt;/listener&gt;</span><br></pre></td></tr></table></figure>
<p>而且要添加maven依赖，注意这两个不一样，api是为了在代码中使用相关的类，但是要输出日志，需要下面的log4j12。要一起，不然会报错，找不到Log4jConfigListener。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.7.25&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.7.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>最后就是，log4j.properties文件：具体的参数参考网上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">### 设置###</span><br><span class="line">log4j.rootLogger = debug,stdout,D,E</span><br><span class="line"></span><br><span class="line">### 输出信息到控制抬 ###</span><br><span class="line">log4j.appender.stdout = org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target = System.out</span><br><span class="line">log4j.appender.stdout.Threshold = INFO </span><br><span class="line">log4j.appender.stdout.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern = [%-5p] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; method:%l%n%m%n</span><br><span class="line"></span><br><span class="line">### 输出DEBUG 级别以上的日志到=E://logs/error.log ###</span><br><span class="line">log4j.appender.D = org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.D.File = /tmp/log/DEBUG.log</span><br><span class="line">log4j.appender.D.Append = true</span><br><span class="line">log4j.appender.D.Threshold = DEBUG </span><br><span class="line">log4j.appender.D.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.D.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %m%n</span><br><span class="line"></span><br><span class="line">### 输出ERROR 级别以上的日志到=E://logs/error.log ###</span><br><span class="line">log4j.appender.E = org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.E.File =/tmp/log/error.log </span><br><span class="line">log4j.appender.E.Append = true</span><br><span class="line">log4j.appender.E.Threshold = ERROR </span><br><span class="line">log4j.appender.E.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.E.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %m%n</span><br></pre></td></tr></table></figure>
<h4 id="7-12"><a href="#7-12" class="headerlink" title="7-12"></a>7-12</h4><p>今天主要写了一个多文件上传的demo，支持一个input，多次上传。</p>
<p>在oracle官网上复习java。</p>
<p>关于一个input上传多个文件的博客：<a href="http://xuxin123.com/2017/09/09/imgfile2/" target="_blank" rel="noopener">http://xuxin123.com/2017/09/09/imgfile2/</a></p>
<h4 id="7-13"><a href="#7-13" class="headerlink" title="7-13"></a>7-13</h4><p>要想在spring中使用redis，需要添加如下的maven依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Redis start --&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.0.7.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--Redis end --&gt;</span><br></pre></td></tr></table></figure>
<p>在springboot中，有时service注入到controller里面失败，是因为Application入口类的问题，在扫描时，它会自动扫描与它同目录或是子目录里面的bean，所以最好不要把它放到controller包里面，这样不会扫描到service底下的类。直接把它放到与controller、service平级的目录下。</p>
<p>泛型擦除：<a href="https://blog.csdn.net/briblue/article/details/76736356" target="_blank" rel="noopener">https://blog.csdn.net/briblue/article/details/76736356</a></p>
<p>当涉及到组件整合的时候，往往会出现问题，最主要的原因是版本的不兼容。</p>
<h4 id="7-14"><a href="#7-14" class="headerlink" title="7-14"></a>7-14</h4><p>Java 里将普通的方法或函数像参数一样传值并不简单，为此，Java 8 增加了一个语言级的新特性，名为 Lambda 表达式。</p>
<p>在函数式编程语言中，函数是一等公民，它们可以独立存在，你可以将其赋值给一个变量，或将他们当做参数传给其他函数。JavaScript 是最典型的函数式编程语言。函数式语言提供了一种强大的功能——闭包，相比于传统的编程方法有很多优势，闭包是一个可调用的对象，它记录了一些信息，这些信息来自于创建它的作用域。Java 现在提供的最接近闭包的概念便是 Lambda 表达式，虽然闭包与 Lambda 表达式之间存在显著差别，但至少 Lambda 表达式是闭包很好的替代者。</p>
<p>在 Java 中，Marker（标记）类型的接口是一种没有方法或属性声明的接口，简单地说，marker 接口是空接口。相似地，函数式接口是只包含一个抽象方法声明的接口。</p>
<h4 id="7-18"><a href="#7-18" class="headerlink" title="7-18"></a>7-18</h4><p>阻塞队列与生产者-消费者模式有很大的联系。</p>
<p>最常见的生产者-消费者设计模式就是线程池与工作队列的组合，在Executor任务执行框架中体现了这种模式。</p>
<p>在Java类库中，任务执行的主要抽象不是Thread，而是Executor。</p>
<p>多文件上传系统中，打包的临时文件保存到哪里了。还有如何删除单个文件时产生的临时文件？</p>
<p>如果不指定文件路径，会默认放到resin的目录下。</p>
<h4 id="7-20"><a href="#7-20" class="headerlink" title="7-20"></a>7-20</h4><p>try、catch中最好以LOG的方式把错误关键信息给出。而不要直接打印出e。比如以下方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOG.error(&quot;getUserByPublicKey failed!&quot;, e);</span><br></pre></td></tr></table></figure>
<h4 id="7-21"><a href="#7-21" class="headerlink" title="7-21"></a>7-21</h4><p>form表单里面的button，如果不加type，那么当你点击时会自动提交表单，所以一定要加type，并指定为button。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=&quot;upload-click&quot; class=&quot;btn btn-default&quot; type=&quot;button&quot;&gt;上传图片&lt;/button&gt;</span><br></pre></td></tr></table></figure>
<p>看过的东西一定要记住，不然就白看了。记忆深刻的必要性。</p>
<h4 id="7-23（上线操作）"><a href="#7-23（上线操作）" class="headerlink" title="7-23（上线操作）"></a>7-23（上线操作）</h4><p>关于api的任务：</p>
<p>这是一个提供给第三方使用的接口，在数据库中有一个认证用户表，只有在这个表里面的用户才能有权限调用这些接口。</p>
<p>每个用户都有一个公钥和私钥。验证授权的过程为，请求中包含有时间戳和签名。服务器端使用传过来的时间戳和该用户的私钥进行SHA1签名，并和传过来的签名进行比较，一致则验证通过。</p>
<p>提交快速订单的接口为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baseUrl/order?method=submitOrder</span><br></pre></td></tr></table></figure>
<p>支付订单的接口为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baseUrl/order?method=payOrder</span><br></pre></td></tr></table></figure>
<p>查询订单的接口为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baseUrl/order?method=getOrder</span><br></pre></td></tr></table></figure>
<p>web项目的上线操作：</p>
<ol>
<li>首先自己分支上的代码要没有问题。</li>
<li>把svn的线上代码checkout到自己的目录下（每次上线后把这个文件夹删除掉）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 qinxue]$ svn co https://dev.corp.youdao.com/svn/outfox/incubator/rengong/milestones/2.0.6xx</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>然后到2.0.6xx目录下合并分支：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 2.0.6xx]$ svn merge -r 616043:616149 https://dev.corp.youdao.com/svn/outfox/incubator/rengong/branches/2.0.6xx_mutiFile .</span><br></pre></td></tr></table></figure>
<p>表示把mutiFile分支上版本616043到616149合并到当前分支，即主分支2.0.6xx。后面的<code>.</code>就是当前目录的意思。</p>
<ol start="4">
<li>合并了如果有conflict就改掉，接着就是commit。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 2.0.6xx]$ svn ci -m &quot;svn merge -r 616043:616149 https://dev.corp.youdao.com/svn/outfox/incubator/rengong/branches/2.0.6xx_mutiFile . to to be reviewed&quot;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>查看<code>https://corp.youdao.com/svn/ydstatic/at</code>下最新的版本号。 更新<code>filter.properties.online/onlineb</code>文件中的<code>RESOURCE_PREFIX</code>。 更新后提交到svn，svn的提交日志我们一般用<code>svn ci -m &quot;change prefix to be reviewed&quot;</code>。具体操作为：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 2.0.6xx]$ vi filter.properties.online </span><br><span class="line">[qinxue@nc060 2.0.6xx]$ vi filter.properties.onlineb </span><br><span class="line">[qinxue@nc060 2.0.6xx]$ svn ci -m &quot;change prefix to be reviewed&quot;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>在<code>translator@nc060: /disk1/atranslate/code</code>下面（注意是用translator账号登陆）压缩js，此时应保证目录下为上线分支，压缩完之后再上传到svn。压缩步骤：确保<code>filter.properties中的STATUS=product</code>，如果有移动端的压缩，也要提交上去。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[translator@nc060 code]$ cd web/script</span><br><span class="line">[translator@nc060 code]$ ./compress.sh</span><br><span class="line">[translator@nc060 code]$ svn ci business.js -m &quot;compress js to be reviewed&quot;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>然后切换到主分支上，生成线上cdn可用的js、css和图片资源。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 2.0.6xx]$ svn up</span><br><span class="line">[qinxue@nc060 2.0.6xx]$ ant online</span><br><span class="line">[qinxue@nc060 2.0.6xx]$ ant dist-web</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>压缩，并上传到 <code>https://corp.youdao.com/svn/ydstatic/at</code>下，<code>http://corp.youdao.com/IT/updateshared/</code>，选择at并提交，等提交选项由红色变成黑色后表示新版cdn可用。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 2.0.6xx]$ cd build/web/</span><br><span class="line">[qinxue@nc060 web]$ tar -cvf 616172.tar.gz 616172/</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>去<code>translator@nc060: /disk1/atranslate/code</code>目录下测试，注意修改<code>default.properties</code>里的resource为on和<code>filter.properties</code>里的引用的cdn的值。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[translator@nc060 code]$ vi default.properties</span><br><span class="line">[translator@nc060 code]$ vi filter.properties</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>到了这里，测试上的东西就是最终上线后可以看到的。后面就可以上线了（具体的运维操作，自己操作）</li>
</ol>
<p>如果要实现等待/通知（生产者/消费者）机制，可以使用synchronize(this)，或者使用lock + condition的方式。</p>
<p>svn中新建分支，并切换过去。前提是code要是一个svn的目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 qinxue]$ svn copy https://dev.corp.youdao.com/svn/outfox/incubator/rengong/milestones/2.0.6xx https://dev.corp.youdao.com/svn/outfox/incubator/rengong/branches/2.0.6xx_api -m &quot;ADD:新建一个修改api的分支&quot;</span><br><span class="line"></span><br><span class="line">[qinxue@nc060 qinxue]$ cd code/</span><br><span class="line"></span><br><span class="line">[qinxue@nc060 code]$ svn sw https://dev.corp.youdao.com/svn/outfox/incubator/rengong/branches/2.0.6xx_api</span><br></pre></td></tr></table></figure>
<p>译员接单调用的接口为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://at-test1.youdao.com/ds/task.do?method=acceptFastTask&amp;orderId=1618795</span><br></pre></td></tr></table></figure>
<h4 id="7-24"><a href="#7-24" class="headerlink" title="7-24"></a>7-24</h4><p>在vim中查找关键字，首先切换到命令行模式，然后<code>/keyword</code>，回车，接着可以通过<code>n</code>一个一个查看。</p>
<p>译员接单调用的接口为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ds/task.do?method=acceptFastTask&amp;orderId=1618795</span><br></pre></td></tr></table></figure>
<p>当译员翻译完成后，点击提交，首先会：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ds/task.do?method=finishFastTask&amp;check=true</span><br></pre></td></tr></table></figure>
<p>在SpringBoot的配置中，如果不加下面的，是无法启动Tomcat的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>学习使用rabbit-mq</p>
<h4 id="7-26"><a href="#7-26" class="headerlink" title="7-26"></a>7-26</h4><p>redis阅读总结（看了什么说出来）：</p>
<p>redis数据库：一个redis服务器可以有多个数据库，这个和mysql是类似的。redis服务器的数据结构redisServer主要由两个字段组成，db指针（它指向一个包含有数据库的数组redisDb* db）和一个dbNum，代表该服务器中有多少个数据库。redis客户端可以通过select命令进行选择。默认在第一个数据库中。客户端有一个指针表示它目前所在的数据库的是哪一个（即目标数据库）。</p>
<p>对于每一个数据库，里面存放的都是键值对，称为键空间。数据库中的增删查改都是在键空间上进行的。数据库的结构主要包含两个字典，一个是dict，负责保存键值对，另外一个是expires，里面存放过期键值对。</p>
<p>过期键的删除策略有3个：</p>
<ol>
<li>定时删除</li>
<li>惰性删除，（遇到时再删除）</li>
<li>定期删除</li>
</ol>
<p>redis采用的是惰性删除+定期删除的策略。需要配置好删除的频率。rdb和aof和复制的过程与过期键的联系。从服务器发现过期键后不会主动删除它，而是等到主服务器发来了del命令后，它才会显式地删除过期键。</p>
<p>redis的通知：两个概念，一个是键用到了哪些命令；另外一个是某个命令被哪些键使用到了。所以有两种通知，一个是键空间通知，一个是键事件通知。发布通知的函数中的参数为：类型（type），键（key），事件（event）和数据库（dbid），可以这样理解，我所发布的是什么类型的通知，表示在哪个数据库上哪个键发生了哪个事件。比如，在1号数据库上，message键发生了一次get的事件。</p>
<p>对于redis数据库的复制，在集群中（多服务器中）会涉及到，被复制的数据库叫主服务器，而发起复制的数据库叫做从服务器，所以也叫作redis的主从复制。他们需要保持一致性。</p>
<p>redis的复制功能分为2个操作：。。。</p>
<p>mysql的主从复制：主服务器会把数据的更改记录到二进制日志中，从服务器包含有2个线程，一个线程为I/O线程，它从主服务器接收日志并写入到中继日志中，另外一个线程为数据库线程，它负责从日志文件中读取数据库指令并执行。总结起来就是完全备份+二进制日志备份的还原，且过程是异步实时的。</p>
<p>1.getInputStream方法可以得到一个输入流，客户端的Socket对象上的getInputStream方法得到输入流其实就是从服务器端发回的数据。</p>
<p>2.getOutputStream方法得到的是一个输出流，客户端的Socket对象上的getOutputStream方法得到的输出流其实就是发送给服务器端的数据。</p>
<h4 id="7-27"><a href="#7-27" class="headerlink" title="7-27"></a>7-27</h4><p>对于修好了pom文件后，springboot启动时出现的tomcat启动失败的问题，不是maven依赖包的问题，而是单独添加的一些jar与之冲突的，所以我把单独引进的jar包删除了很多，只留下不冲突的几个，这样就没有问题了。</p>
<p>继续研究http协议相关的知识，这方面对于后台来说很重要。核心就是request与response。</p>
<p>最近做文件下载的实验，踩到一个坑，如果使用ajax的方式下载（不管是get，还是post），那么虽然后台没有任何错误信息，还是下载不了，浏览器不会下载。当然如果直接通过a标签设置href就可以了（使用的是get），找了原因，原来：</p>
<blockquote>
<p>ajax方式下载文件时无法触发浏览器打开保存文件对话框，也就无法将下载的文件保存到硬盘上！原因：ajax方式请求的数据只能存放在javascipt内存空间，可以通过javascript访问，但是无法保存到硬盘，因为javascript不能直接和硬盘交互，否则将是一个安全问题。</p>
</blockquote>
<p>所以可以采用模拟表单提交的方式实现post传递数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span><br><span class="line">    &lt;title&gt;文件下载&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; th:href=&quot;@&#123;../../static/css/upload.css&#125;&quot; /&gt;</span><br><span class="line">    &lt;script th:src=&quot;@&#123;../../static/js/jquery-3.3.1.js&#125;&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script th:src=&quot;@&#123;../../static/js/upload.js&#125;&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;download&quot;&gt;</span><br><span class="line">    &lt;div&gt;&lt;a id=&quot;download&quot; class=&quot;btn&quot; href=&quot;#&quot;&gt;Download&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    /*&lt;![CDATA[*/</span><br><span class="line">    $(&quot;#download&quot;).click(function () &#123;</span><br><span class="line">       // $.ajax(&#123;</span><br><span class="line">       //     url: &quot;do_download&quot;,</span><br><span class="line">       //     type: &quot;get&quot;</span><br><span class="line">       // &#125;);</span><br><span class="line">        downloadFileByForm();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 模拟表单提交同步方式下载文件，能够弹出保存文件对话框</span><br><span class="line">    function downloadFileByForm() &#123;</span><br><span class="line">        var url = &quot;do_download&quot;;</span><br><span class="line">        var fileName = &quot;秦学-18166454061-xqconverse@163.com-Java开发工程师.pdf&quot;;</span><br><span class="line">        var form = $(&quot;&lt;form&gt;&lt;/form&gt;&quot;).attr(&quot;action&quot;, url).attr(&quot;method&quot;, &quot;post&quot;);</span><br><span class="line">        form.append($(&quot;&lt;input /&gt;&quot;).attr(&quot;type&quot;, &quot;hidden&quot;).attr(&quot;name&quot;, &quot;fileName&quot;).attr(&quot;value&quot;, fileName));</span><br><span class="line">        form.appendTo(&apos;body&apos;).submit().remove();</span><br><span class="line">    &#125;</span><br><span class="line">    /*]]&gt;*/</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="7-28"><a href="#7-28" class="headerlink" title="7-28"></a>7-28</h4><p>获取文档的contentType，可以使用jdk7自带的<code>Files.probeContentType(Paths.get(inputValue))</code>，使用MagicMatch有一些坑，比如无法识别txt等文件。</p>
<h4 id="7-31"><a href="#7-31" class="headerlink" title="7-31"></a>7-31</h4><p>关于api调用的安全性参考文章如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/codelir/p/5327462.html</span><br></pre></td></tr></table></figure>
<h4 id="8-1"><a href="#8-1" class="headerlink" title="8-1"></a>8-1</h4><p>swagger遇到的坑</p>
<p>一开始的application.properties文件中通过这个来加载静态文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.static-path-pattern=/static/**</span><br></pre></td></tr></table></figure>
<p>按照过程来会遇到404的错误。在网上找了很多解决方案，大多数都是这样，让swagger的配置类继承WebMvcConfigurationSupport类。重写addResourceHandlers方法。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        registry.addResourceHandler(&quot;swagger-ui.html&quot;)</span><br><span class="line">        .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;/webjars*&quot;)</span><br><span class="line">        .addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这样确实解决了swagger-ui.html访问不了的问题。但是对于我的应用来说，就是拆了西墙补东墙。因为项目中有很多的界面需要加载静态文件，所以这样一改，其它界面就加载不出静态文件了。</p>
<p>于是我加上了这句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry.addResourceHandler(&quot;/**&quot;).addResourceLocations(&quot;classpath:/static/&quot;);</span><br></pre></td></tr></table></figure>
<p>这样和之前一样，没什么变化。其它界面还是加载不出来。后来查到资料，发现这样写它只能遍历到static文件底下。而我的静态资源在static底下分了类，比如js,css,img等等。所以应该改成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry.addResourceHandler(&quot;/static/**&quot;).addResourceLocations(&quot;classpath:/static/&quot;);</span><br></pre></td></tr></table></figure>
<p>这样发现其它的界面确实加载出来了。但是swagger-ui.html的资源文件加载不出来了（能访问，不是404）。这就很冲突了。因为它这边直接放在static底下没有分类的文件夹，而我的有。</p>
<p>后来改成这样就可以了：思路很简单，原来的静态文件还是通过<code>/static/**</code>来加载<code>classpath:/static/</code>，swagger的则通过<code>/**</code>来加载<code>classpath:/META-INF/resources/</code>，加载的路径也不一样的。之前搞混淆了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        registry.addResourceHandler(&quot;/**&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;/static/**&quot;).addResourceLocations(&quot;classpath:/static/&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-2"><a href="#8-2" class="headerlink" title="8-2"></a>8-2</h4><p>如果需要上线的话，别忘了在application.properties.online中加入调用分单系统的MQ参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#调用分单系统的MQ参数</span><br><span class="line">DS_CALL_EXCHANGE=dsCallExchange</span><br><span class="line">DS_CALL_QUEUE=dsCallQueue</span><br><span class="line">DS_CALL_ROUTINGKEY=dsCallRouting</span><br></pre></td></tr></table></figure>
<p>error日志里尽量带着订单号，这样方便查找！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 把org.json.simple.JSONObject转换成org.json.JSONObject</span><br><span class="line">JSONObject json = new JSONObject(FileParserHelper.calculateFileOrderTime(word, order.getSrcLang(), order.getDesLang()).toJSONString());</span><br></pre></td></tr></table></figure>
<p>关于静态变量的注入参考这篇文章：需要注意的是，setter函数必须是非静态的。而且property的name值不要写变量名，而应该与setter函数的函数名一直，驼峰模式的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;apiConfig&quot; class=&quot;atranslate.api.common.ApiConfig&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;baseUrl&quot; value=&quot;$&#123;API_BASE_URL&#125;&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;translateResultUrl&quot; value=&quot;$&#123;TRANSLATE_RESULT_URL&#125;&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;maxTextLength&quot; value=&quot;$&#123;MAX_TEXT_LENGTH&#125;&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;maxPageSize&quot; value=&quot;$&#123;MAX_PAGE_SIZE&#125;&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;fileMaxSiz&quot; value=&quot;$&#123;FILE_MAX_SIZE&#125;&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class ApiConfig &#123;</span><br><span class="line">    public static String BASE_URL;</span><br><span class="line"></span><br><span class="line">    public static int MAX_TEXT_LENGTH; // 文本翻译最大长度</span><br><span class="line"></span><br><span class="line">    public static int MAX_PAGE_SIZE; // 分页请求时，单页最大大小</span><br><span class="line"></span><br><span class="line">    public void setBaseUrl(String baseUrl) &#123;</span><br><span class="line">        BASE_URL = baseUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMaxTextLength(int maxTextLength) &#123;</span><br><span class="line">        MAX_TEXT_LENGTH = maxTextLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMaxPageSize(int maxPageSize) &#123;</span><br><span class="line">        MAX_PAGE_SIZE = maxPageSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">https://blog.csdn.net/casablancaagnes_3sdf/article/details/52240910</span><br></pre></td></tr></table></figure>
<h4 id="8-3"><a href="#8-3" class="headerlink" title="8-3"></a>8-3</h4><p>http请求的request headers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://ks.netease.com/blog?id=12330</span><br><span class="line">Request Method: GET</span><br><span class="line">Status Code: 200 OK</span><br><span class="line">Remote Address: 127.0.0.1:8889</span><br><span class="line">Referrer Policy: no-referrer-when-downgrade</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET http://ks.netease.com/blog?id=12330 HTTP/1.1</span><br><span class="line">Host: ks.netease.com</span><br><span class="line">Proxy-Connection: keep-alive</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,fr;q=0.8,zh-TW;q=0.7</span><br><span class="line">Cookie: __utmc=200619188; __utmz=200619188.1533018928.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); NTESwebSI=060E41ACEE407CE1C394BF588E512C97.hzaxs-fg-ks1.server.163.org-8081; NETEASE_WDA_UID=23435#|#1530186713000; __utma=200619188.1924544844.1533018928.1533262604.1533278040.3; __utmb=200619188.2.10.1533278040; knowledge_sharing_=-WjDV_HqSDglM5HJuY_S6ic3NgNBHyZcbYb38JKNpcmAkem3DOdBuiYbszcAXTVZ</span><br></pre></td></tr></table></figure>
<p>response headers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Fri, 03 Aug 2018 06:51:30 GMT</span><br><span class="line">Content-Type: text/html;charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Set-Cookie: knowledge_sharing_=-WjDV_HqSDglM5HJuY_S6ic3NgNBHyZcbYb38JKNpcmAkem3DOdBuiYbszcAXTVZ; Expires=Thu, 01-Jan-1970 00:00:10 GMT; Path=/</span><br><span class="line">Set-Cookie: knowledge_sharing_=JN_meKFuoEF82EnftgYJRvnEOG6ykxYbcq2Ev7L1pfAz6r0Hi-8882ItdF6aF3LT; Expires=Fri, 03-Aug-2018 12:51:30 GMT; Path=/; HttpOnly</span><br><span class="line">Content-Language: zh-CN</span><br><span class="line">Content-Encoding: gzip</span><br></pre></td></tr></table></figure>
<p>query string parameters</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id: 12330</span><br></pre></td></tr></table></figure>
<p>Cookies包含Request Cookies和esponse Cookies</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://ks.netease.com/getuserinfo</span><br><span class="line">Request Method: POST</span><br><span class="line">Status Code: 200 OK</span><br><span class="line">Remote Address: 127.0.0.1:8889</span><br><span class="line">Referrer Policy: no-referrer-when-downgrade</span><br><span class="line"></span><br><span class="line">POST http://ks.netease.com/getuserinfo HTTP/1.1</span><br><span class="line">Host: ks.netease.com</span><br><span class="line">Proxy-Connection: keep-alive</span><br><span class="line">Content-Length: 0</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">Origin: http://ks.netease.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36</span><br><span class="line">Referer: http://ks.netease.com/blog?id=12330</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,fr;q=0.8,zh-TW;q=0.7</span><br><span class="line">Cookie: __utmc=200619188; __utmz=200619188.1533018928.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); NTESwebSI=060E41ACEE407CE1C394BF588E512C97.hzaxs-fg-ks1.server.163.org-8081; NETEASE_WDA_UID=23435#|#1530186713000; __utma=200619188.1924544844.1533018928.1533262604.1533278040.3; __utmb=200619188.2.10.1533278040; knowledge_sharing_=JN_meKFuoEF82EnftgYJRvnEOG6ykxYbcq2Ev7L1pfAz6r0Hi-8882ItdF6aF3LT</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Fri, 03 Aug 2018 06:51:30 GMT</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Set-Cookie: knowledge_sharing_=JN_meKFuoEF82EnftgYJRvnEOG6ykxYbcq2Ev7L1pfAz6r0Hi-8882ItdF6aF3LT; Expires=Thu, 01-Jan-1970 00:00:10 GMT; Path=/</span><br><span class="line">Set-Cookie: knowledge_sharing_=JN_meKFuoEF82EnftgYJRqnGNXMNjT0Z_2NgDqevB7unoHmiOWSm6miZrAEU4019; Expires=Fri, 03-Aug-2018 12:51:30 GMT; Path=/; HttpOnly</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache, no-store, max-age=0</span><br><span class="line">Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="line">Content-Language: zh-CN</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">&#123;</span><br><span class="line">	&quot;circles&quot;: [&#123;</span><br><span class="line">		&quot;id&quot;: 9,</span><br><span class="line">		&quot;name&quot;: &quot;大数据技术&quot;,</span><br><span class="line">		&quot;typeId&quot;: 6,</span><br><span class="line">		&quot;ownerId&quot;: 6,</span><br><span class="line">		&quot;owner&quot;: &quot;潘照明&quot;,</span><br><span class="line">		&quot;descr&quot;: &quot;&quot;,</span><br><span class="line">		&quot;ava&quot;: &quot;http://nos.netease.com/knowledge/df286ec5-e511-4292-926e-400c100a78c4&quot;,</span><br><span class="line">		&quot;memberCount&quot;: 4623,</span><br><span class="line">		&quot;blogCount&quot;: 59,</span><br><span class="line">		.....</span><br><span class="line">		&#125;],</span><br><span class="line">		&quot;blogList&quot;: []</span><br><span class="line">	&#125;],</span><br><span class="line">	&quot;code&quot;: 200,</span><br><span class="line">	&quot;user&quot;: &#123;</span><br><span class="line">		&quot;id&quot;: 23435,</span><br><span class="line">		&quot;name&quot;: &quot;秦学&quot;,</span><br><span class="line">		&quot;descr&quot;: &quot;&quot;,</span><br><span class="line">		&quot;ava&quot;: &quot;http://nos.netease.com/knowledge/58b5c356-4af6-42cf-acc1-a4e42b73bdab&quot;,</span><br><span class="line">		&quot;email&quot;: &quot;qinxue@corp.netease.com&quot;,</span><br><span class="line">		&quot;dep&quot;: &quot;有道事业部-人工翻译产品部&quot;,</span><br><span class="line">		&quot;position&quot;: &quot;&quot;,</span><br><span class="line">		&quot;empno&quot;: &quot;BJS6539&quot;,</span><br><span class="line">		&quot;admin&quot;: 0,</span><br><span class="line">		&quot;registerTime&quot;: 1530186713000,</span><br><span class="line">		&quot;loginTime&quot;: 1533279090000</span><br><span class="line">	&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line">Request URL: http://ks.netease.com/getComment</span><br><span class="line">Request Method: POST</span><br><span class="line">Status Code: 200 OK</span><br><span class="line">Remote Address: 127.0.0.1:8889</span><br><span class="line">Referrer Policy: no-referrer-when-downgrade</span><br><span class="line"></span><br><span class="line">POST http://ks.netease.com/getComment HTTP/1.1</span><br><span class="line">Host: ks.netease.com</span><br><span class="line">Proxy-Connection: keep-alive</span><br><span class="line">Content-Length: 26</span><br><span class="line">Origin: http://ks.netease.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://ks.netease.com/blog?id=12330</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,fr;q=0.8,zh-TW;q=0.7</span><br><span class="line">Cookie: __utmc=200619188; __utmz=200619188.1533018928.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); NTESwebSI=060E41ACEE407CE1C394BF588E512C97.hzaxs-fg-ks1.server.163.org-8081; NETEASE_WDA_UID=23435#|#1530186713000; __utma=200619188.1924544844.1533018928.1533262604.1533278040.3; __utmb=200619188.2.10.1533278040; knowledge_sharing_=JN_meKFuoEF82EnftgYJRlnSp4y_nwqjsJsOD8xMHP09k3cBRUe0bKxmTnXT-Neo</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Fri, 03 Aug 2018 06:51:31 GMT</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Set-Cookie: knowledge_sharing_=JN_meKFuoEF82EnftgYJRlnSp4y_nwqjsJsOD8xMHP09k3cBRUe0bKxmTnXT-Neo; Expires=Thu, 01-Jan-1970 00:00:10 GMT; Path=/</span><br><span class="line">Set-Cookie: knowledge_sharing_=jze8b83V-gbkeAe7PR5To8DZCKSYhKr3QK09PfyAea7gsMxba29_QllVaklh52lv; Expires=Fri, 03-Aug-2018 12:51:31 GMT; Path=/; HttpOnly</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache, no-store, max-age=0</span><br><span class="line">Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="line">Content-Language: zh-CN</span><br><span class="line">Content-Encoding: gzip</span><br></pre></td></tr></table></figure>
<p>form data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">id: 12330</span><br><span class="line">offset: 0</span><br><span class="line">limit: 15</span><br><span class="line">&#123;</span><br><span class="line">	&quot;limit&quot;: 15,</span><br><span class="line">	&quot;total&quot;: 3,</span><br><span class="line">	&quot;code&quot;: 200,</span><br><span class="line">	&quot;offset&quot;: 0,</span><br><span class="line">	&quot;commentList&quot;: [&#123;</span><br><span class="line">		&quot;id&quot;: 9762,</span><br><span class="line">		&quot;blogId&quot;: 12330,</span><br><span class="line">		&quot;blog&quot;: null,</span><br><span class="line">		&quot;userId&quot;: 23615,</span><br><span class="line">		&quot;user&quot;: &#123;</span><br><span class="line">			&quot;id&quot;: 23615,</span><br><span class="line">			&quot;name&quot;: &quot;李国斌&quot;,</span><br><span class="line">			&quot;descr&quot;: &quot;&quot;,</span><br><span class="line">			&quot;ava&quot;: &quot;http://nos.netease.com/knowledge/58b5c356-4af6-42cf-acc1-a4e42b73bdab&quot;,</span><br><span class="line">			&quot;email&quot;: &quot;liguobin@corp.netease.com&quot;,</span><br><span class="line">			&quot;dep&quot;: &quot;杭州研究院-教育产品部&quot;,</span><br><span class="line">			&quot;position&quot;: &quot;&quot;,</span><br><span class="line">			&quot;empno&quot;: &quot;HZS11706&quot;,</span><br><span class="line">			&quot;admin&quot;: 0,</span><br><span class="line">			&quot;registerTime&quot;: 1530683410000,</span><br><span class="line">			&quot;loginTime&quot;: 1533027094000</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;comment&quot;: &quot;mark&quot;,</span><br><span class="line">		&quot;time&quot;: 1533027094000,</span><br><span class="line">		&quot;toUserId&quot;: 0,</span><br><span class="line">		&quot;toUser&quot;: null,</span><br><span class="line">		&quot;type&quot;: 0</span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		&quot;id&quot;: 9761,</span><br><span class="line">		&quot;blogId&quot;: 12330,</span><br><span class="line">		&quot;blog&quot;: null,</span><br><span class="line">		&quot;userId&quot;: 17913,</span><br><span class="line">		&quot;user&quot;: &#123;</span><br><span class="line">			&quot;id&quot;: 17913,</span><br><span class="line">			&quot;name&quot;: &quot;赵计刚&quot;,</span><br><span class="line">			&quot;descr&quot;: &quot;酷爱服务框架、服务治理、服务容器、微服务架构&quot;,</span><br><span class="line">			&quot;ava&quot;: &quot;http://nos.netease.com/knowledge/98cc83b2-e080-41d6-bf75-5db6cf1f4faf?imageView&amp;thumbnail=60y60&quot;,</span><br><span class="line">			&quot;email&quot;: &quot;zhaojigang@corp.netease.com&quot;,</span><br><span class="line">			&quot;dep&quot;: &quot;跨境电商-长城工作室&quot;,</span><br><span class="line">			&quot;position&quot;: &quot;&quot;,</span><br><span class="line">			&quot;empno&quot;: &quot;H12514&quot;,</span><br><span class="line">			&quot;admin&quot;: 0,</span><br><span class="line">			&quot;registerTime&quot;: 1505794908000,</span><br><span class="line">			&quot;loginTime&quot;: 1533260061000</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;comment&quot;: &quot;https://github.com/apache/incubator-dubbo/pull/1745\n嗯，这个是dubbo2.6.3版本新加的，直接从netty简化移植过来的，当时这个pull request合并的时候没有注明netty的版权头，netty的作者normanmaurer还出来说了一把&quot;,</span><br><span class="line">		&quot;time&quot;: 1533020528000,</span><br><span class="line">		&quot;toUserId&quot;: 4330,</span><br><span class="line">		&quot;toUser&quot;: &#123;</span><br><span class="line">			&quot;id&quot;: 4330,</span><br><span class="line">			&quot;name&quot;: &quot;吴梦升&quot;,</span><br><span class="line">			&quot;descr&quot;: &quot;&quot;,</span><br><span class="line">			&quot;ava&quot;: &quot;http://nos.netease.com/knowledge/58b5c356-4af6-42cf-acc1-a4e42b73bdab&quot;,</span><br><span class="line">			&quot;email&quot;: &quot;hzwumsh@corp.netease.com&quot;,</span><br><span class="line">			&quot;dep&quot;: &quot;网易支付-支付技术部&quot;,</span><br><span class="line">			&quot;position&quot;: &quot;&quot;,</span><br><span class="line">			&quot;empno&quot;: &quot;H6011&quot;,</span><br><span class="line">			&quot;admin&quot;: 0,</span><br><span class="line">			&quot;registerTime&quot;: 1418356456000,</span><br><span class="line">			&quot;loginTime&quot;: 1533199240000</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;type&quot;: 0</span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		&quot;id&quot;: 9760,</span><br><span class="line">		&quot;blogId&quot;: 12330,</span><br><span class="line">		&quot;blog&quot;: null,</span><br><span class="line">		&quot;userId&quot;: 4330,</span><br><span class="line">		&quot;user&quot;: &#123;</span><br><span class="line">			&quot;id&quot;: 4330,</span><br><span class="line">			&quot;name&quot;: &quot;吴梦升&quot;,</span><br><span class="line">			&quot;descr&quot;: &quot;&quot;,</span><br><span class="line">			&quot;ava&quot;: &quot;http://nos.netease.com/knowledge/58b5c356-4af6-42cf-acc1-a4e42b73bdab&quot;,</span><br><span class="line">			&quot;email&quot;: &quot;hzwumsh@corp.netease.com&quot;,</span><br><span class="line">			&quot;dep&quot;: &quot;网易支付-支付技术部&quot;,</span><br><span class="line">			&quot;position&quot;: &quot;&quot;,</span><br><span class="line">			&quot;empno&quot;: &quot;H6011&quot;,</span><br><span class="line">			&quot;admin&quot;: 0,</span><br><span class="line">			&quot;registerTime&quot;: 1418356456000,</span><br><span class="line">			&quot;loginTime&quot;: 1533199240000</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;comment&quot;: &quot;可以看下dubbo重写的threadlocal\nhttps://github.com/apache/incubator-dubbo/tree/master/dubbo-common/src/main/java/org/apache/dubbo/common/threadlocal&quot;,</span><br><span class="line">		&quot;time&quot;: 1533018298000,</span><br><span class="line">		&quot;toUserId&quot;: 0,</span><br><span class="line">		&quot;toUser&quot;: null,</span><br><span class="line">		&quot;type&quot;: 0</span><br><span class="line">	&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>刚刚遇到公司断网，然后再次打开电脑，啥都可以（客户端连接，比如qq等，也可以ping通外网，说明dns也没有问题），就是打不开网页。后来百度了才发现，是fiddler的原因，打开它再关闭它，然后再次打开网页就可以了。刷新了断网后排除问题的世界观。断网了，可以利用计算机网络的5层模型一个一个排除。首先看线路有没有问题（可以排除物理层的问题），后面再登陆一些客户端（比如QQ），如果可以的话，那说明网络层和传输层没有问题。后面再看dns是不是有问题（这个可以排除应用层的问题）。</p>
<p>看一下这篇文章： <a href="https://blog.csdn.net/BuquTianya/article/details/53689923" target="_blank" rel="noopener">https://blog.csdn.net/BuquTianya/article/details/53689923</a></p>
<p>可以查看dns是否正常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup baidu.com</span><br></pre></td></tr></table></figure>
<h4 id="8-8"><a href="#8-8" class="headerlink" title="8-8"></a>8-8</h4><p>在项目中关于http response，一般这样写：包括返回普通文本，返回html，返回json。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">protected static ModelAndView renderText(HttpServletResponse response, String content) &#123;</span><br><span class="line">    response.setContentType(&quot;text/plain;charset=utf-8&quot;);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        response.getWriter().write(content);</span><br><span class="line">        return null;</span><br><span class="line">    &#125; catch (IOException var4) &#123;</span><br><span class="line">        String message = &quot;renderText failed&quot;;</span><br><span class="line">        LOG.error(message + &quot;: &quot; + content, var4);</span><br><span class="line">        throw new RuntimeException(message, var4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected static ModelAndView renderHtml(HttpServletResponse response, String content) &#123;</span><br><span class="line">    response.setContentType(&quot;text/html;charset=utf-8&quot;);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        response.getWriter().write(content);</span><br><span class="line">        return null;</span><br><span class="line">    &#125; catch (IOException var4) &#123;</span><br><span class="line">        String message = &quot;renderText failed&quot;;</span><br><span class="line">        LOG.error(message + &quot;: &quot; + content, var4);</span><br><span class="line">        throw new RuntimeException(message, var4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected static ModelAndView renderJsonString(HttpServletResponse response, String jsonString) &#123;</span><br><span class="line">    response.setContentType(&quot;application/json;charset=utf-8&quot;);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        response.getWriter().write(jsonString);</span><br><span class="line">        return null;</span><br><span class="line">    &#125; catch (IOException var4) &#123;</span><br><span class="line">        String message = &quot;renderJson failed&quot;;</span><br><span class="line">        LOG.error(message + &quot;: &quot; + jsonString, var4);</span><br><span class="line">        throw new RuntimeException(message, var4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到唯一的区别在于setContentType里面的内容不同，而一致的是都是通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.getWriter().write(xxx);</span><br></pre></td></tr></table></figure>
<p>来写数据到response。</p>
<p>设置字符串编码可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">originalName = new String(originalName.getBytes(), &quot;ISO-8859-1&quot;);</span><br></pre></td></tr></table></figure>
<p>与Excel相关的：使用InputStream读取文件，接着用处理的excel的类来解析这个输入流即可。</p>
<p>压缩文件，用inputstream读取文件，outputstream写入到压缩文件。具体可以（伪代码，不考虑异常等情况）：关键是用buffer传递数据。input读，output写。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">byte[] buffer = new byte[1024];</span><br><span class="line">ZipOutputStream outputStream = new ZipOutputStream(new FileOutputStream(zipFile));</span><br><span class="line">for (File file : fileList) &#123;</span><br><span class="line">    FileInputStream inputStream = new FileInputStream(file);</span><br><span class="line">    outputStream.putNextEntry(new ZipEntry(file.getName()));</span><br><span class="line">    int len;</span><br><span class="line">    while ((len = inputStream.read(buffer)) &gt; 0) &#123;</span><br><span class="line">        outputStream.write(buffer, 0, len);</span><br><span class="line">    &#125;</span><br><span class="line">    outputStream.closeEntry();</span><br><span class="line">    inputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写csv文件：大概这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder sb = new StringBuilder();</span><br><span class="line">for (int i = 0; i &lt; values.length; i++) &#123;</span><br><span class="line">    if (i != 0) &#123;</span><br><span class="line">        sb.append(&apos;,&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    sb.append(object2Csv(values[i]));</span><br><span class="line">&#125;</span><br><span class="line">return sb.toString();</span><br></pre></td></tr></table></figure>
<p>用InetAddress来获取主机相关的信息</p>
<h4 id="8-9"><a href="#8-9" class="headerlink" title="8-9"></a>8-9</h4><p>如果没有登录，那么localUser没有，而且username也没有； 如果登录了</p>
<ol>
<li>已经消费的用户（数据库中有），那么localUser就会有该用户</li>
<li>没有消费过的用户（数据库中没有），那么localUser就没有，但是username有，即该用户登录的邮箱，这时就会构造一个假用户，给它赋予随机的id。</li>
</ol>
<p>linux上拷贝文件到mac本地，参考这篇博客： <a href="https://stackoverflow.com/questions/27643519/cp-cannot-create-regular-file-users-james-desktop-no-such-file-or-directory" target="_blank" rel="noopener">https://stackoverflow.com/questions/27643519/cp-cannot-create-regular-file-users-james-desktop-no-such-file-or-directory</a></p>
<p>可以这样写，注意要在本地用scp，而不是在服务器下面用scp，不然识别不了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh-3.2# scp translator@nc060x.corp.youdao.com:/disk1/atranslate/hts-component/build/hts-component.jar /Users/XFade/Desktop</span><br></pre></td></tr></table></figure>
<h4 id="8-10"><a href="#8-10" class="headerlink" title="8-10"></a>8-10</h4><p>git中merge单个文件，而不是全部分支时的操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (multiFile)</span><br><span class="line">$ git br</span><br><span class="line">  api</span><br><span class="line">  master</span><br><span class="line">* multiFile</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (multiFile)</span><br><span class="line">$ git co master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is behind &apos;origin/master&apos; by 114 commits, and can be fast-forwarded.</span><br><span class="line">  (use &quot;git pull&quot; to update your local branch)</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (master)</span><br><span class="line">$ git checkout --patch multiFile web/WEB-INF/vm/mail/fileMailToUser.vm</span><br><span class="line">diff --git b/web/WEB-INF/vm/mail/fileMailToUser.vm a/web/WEB-INF/vm/mail/fileMailToUser.vm</span><br><span class="line">index debe557..d1125b0 100644</span><br><span class="line">--- b/web/WEB-INF/vm/mail/fileMailToUser.vm</span><br><span class="line">+++ a/web/WEB-INF/vm/mail/fileMailToUser.vm</span><br><span class="line">@@ -24,6 +24,9 @@</span><br><span class="line">     #end</span><br><span class="line"> &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">+&lt;p&gt;</span><br><span class="line">+    &lt;strong&gt;&lt;a href=&quot;https://f.youdao.com/jifen.do?method=jifen18&quot;&gt;积分换礼活动火热进行中，iPhone X等大奖等你领！&gt;&gt;&lt;/a&gt;&lt;/strong&gt;</span><br><span class="line">+&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"> &lt;p&gt;</span><br><span class="line">     ----------------------------------------&lt;br /&gt;</span><br><span class="line">Apply this hunk to index and worktree [y,n,q,a,d,e,?]? y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (master)</span><br><span class="line">$ git checkout --patch multiFile web/WEB-INF/vm/mail/mailResultToUser.vm</span><br><span class="line">diff --git b/web/WEB-INF/vm/mail/mailResultToUser.vm a/web/WEB-INF/vm/mail/mailResultToUser.vm</span><br><span class="line">index 49233bc..60b2c5a 100644</span><br><span class="line">--- b/web/WEB-INF/vm/mail/mailResultToUser.vm</span><br><span class="line">+++ a/web/WEB-INF/vm/mail/mailResultToUser.vm</span><br><span class="line">@@ -23,6 +23,10 @@</span><br><span class="line">     #end</span><br><span class="line"> &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">+&lt;p&gt;</span><br><span class="line">+    &lt;strong&gt;&lt;a href=&quot;https://f.youdao.com/jifen.do?method=jifen18&quot;&gt;积分换礼活动火热进行中，iPhone X等大奖等你领！&gt;&gt;&lt;/a&gt;&lt;/strong&gt;</span><br><span class="line">+&lt;/p&gt;</span><br><span class="line">+</span><br><span class="line"> &lt;p&gt;</span><br><span class="line">     &lt;strong&gt;有道人工翻译订单&lt;/strong&gt;</span><br><span class="line">     &lt;br /&gt;订单号：$&#123;order.id&#125;</span><br><span class="line">Apply this hunk to index and worktree [y,n,q,a,d,e,?]? y</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (master)</span><br><span class="line">$ git st</span><br><span class="line">On branch master</span><br><span class="line">Your branch is behind &apos;origin/master&apos; by 114 commits, and can be fast-forwarded.</span><br><span class="line">  (use &quot;git pull&quot; to update your local branch)</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">        modified:   web/WEB-INF/vm/mail/fileMailToUser.vm</span><br><span class="line">        modified:   web/WEB-INF/vm/mail/mailResultToUser.vm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (master)</span><br><span class="line">$ git ci -m &quot;mod:积分活动，合并2个文件分支&quot;</span><br><span class="line">[master 8646d74] mod:积分活动，合并2个文件分支</span><br><span class="line"> 2 files changed, 7 insertions(+)</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (master)</span><br><span class="line">$ git pull</span><br><span class="line">Enter passphrase for key &apos;/c/Users/qinxue/.ssh/id_rsa&apos;:</span><br><span class="line">Removing src/core/atranslate/common/OrderStatusHelper.java</span><br><span class="line">Merge made by the &apos;recursive&apos; strategy.</span><br><span class="line"> filter.properties.example                          |   8 +-</span><br><span class="line"> filter.properties.online                           |  11 +-</span><br><span class="line"> ivy.xml                                            |   8 +-</span><br><span class="line"> ......</span><br><span class="line"> web/WEB-INF/web.web.xml                            |   2 +</span><br><span class="line"> 60 files changed, 3108 insertions(+), 2074 deletions(-)</span><br><span class="line"> delete mode 100644 src/core/atranslate/common/OrderStatusHelper.java</span><br><span class="line"> create mode 100644 web/WEB-INF/vm/distribute/adminSubTaskDetail.vm</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/hts-ds (master)</span><br><span class="line">$ git push</span><br><span class="line">Enter passphrase for key &apos;/c/Users/qinxue/.ssh/id_rsa&apos;:</span><br><span class="line">Counting objects: 13, done.</span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">Compressing objects: 100% (13/13), done.</span><br><span class="line">Writing objects: 100% (13/13), 1.36 KiB | 1.36 MiB/s, done.</span><br><span class="line">Total 13 (delta 11), reused 0 (delta 0)</span><br><span class="line">To gitlab.corp.youdao.com:translator-dev/hts-ds.git</span><br><span class="line">   418f2f5..30a32e7  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>git上创建fanyi-edit新分支：branch20180809</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (master)</span><br><span class="line">$ git br</span><br><span class="line">* master</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (master)</span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (master)</span><br><span class="line">$ git br -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/master</span><br><span class="line">  remotes/origin/branch20180809</span><br><span class="line">  remotes/origin/master</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (master)</span><br><span class="line">$ git co -b branch20180809 origin/branch20180809</span><br><span class="line">Switched to a new branch &apos;branch20180809&apos;</span><br><span class="line">Branch &apos;branch20180809&apos; set up to track remote branch &apos;branch20180809&apos; from &apos;origin&apos;.</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (branch20180809)</span><br><span class="line">$ git br</span><br><span class="line">* branch20180809</span><br><span class="line">  master</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (branch20180809)</span><br><span class="line">$ git pull</span><br><span class="line">Enter passphrase for key &apos;/c/Users/qinxue/.ssh/id_rsa&apos;:</span><br><span class="line">Already up to date.</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (branch20180809)</span><br><span class="line">$ git st</span><br><span class="line">On branch branch20180809</span><br><span class="line">Your branch is up to date with &apos;origin/branch20180809&apos;.</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line">qinxue@BIH-D-50083 MINGW64 /d/Projects/fanyi-edit (branch20180809)</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>在idea中导入一个基于maven的module时，点击<code>File -&gt; New -&gt; Module from existing resources</code></p>
<p>当前session暂时切换到java8的配置下，这样改了后，原先mvn中的jdk7也会自动变成jdk8的环境。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 fanyi-edit]$ export JAVA_HOME=/usr/java/jdk1.8.0_60/;</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ export PATH=$JAVA_HOME/bin:$PATH;</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ java -version</span><br><span class="line">java version &quot;1.8.0_60&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_60-b27)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ mvn -v</span><br><span class="line">Apache Maven 3.0.3 (r1075438; 2011-03-01 01:31:09+0800)</span><br><span class="line">Maven home: /global/sww/apache-maven-3.0.3</span><br><span class="line">Java version: 1.8.0_60, vendor: Oracle Corporation</span><br><span class="line">Java home: /usr/java/jdk1.8.0_60/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;2.6.32-642.el6.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure>
<p>临时切换maven的方法也是类似的，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 fanyi-edit]$ export MAVEN_HOME=/global/sww/apache-maven-3.5.2/</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ export PATH=$MAVEN_HOME/bin:$PATH </span><br><span class="line">[qinxue@nc060 fanyi-edit]$ mvn -v</span><br><span class="line">Apache Maven 3.5.2 (138edd61fd100ec658bfa2d307c43b76940a5d7d; 2017-10-18T15:58:13+08:00)</span><br><span class="line">Maven home: /global/sww/apache-maven-3.5.2</span><br><span class="line">Java version: 1.8.0_60, vendor: Oracle Corporation</span><br><span class="line">Java home: /usr/java/jdk1.8.0_60/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;2.6.32-642.el6.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure>
<p>如果在mapper文件上加上@Mapper，会这样报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No qualifying bean of type &apos;cat.storage.ICatOrdersStorage&apos; available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: &#123;@org.springframework.beans.factory.annotation.Autowired(required=true)&#125;</span><br></pre></td></tr></table></figure>
<p>在入口applicationl类上面加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@MapperScan(&quot;cat.storage&quot;)</span><br></pre></td></tr></table></figure>
<p>就不会报错了，这样就会自动扫描mapper类了，而且不用每个文件都加上@Mapper。</p>
<p>mac上开启rabbitmq</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qx:3.7.7 XFade$ ./sbin/rabbitmq-server</span><br></pre></td></tr></table></figure>
<h4 id="8-13（Ribbon）"><a href="#8-13（Ribbon）" class="headerlink" title="8-13（Ribbon）"></a>8-13（Ribbon）</h4><p>noshelper相关的初始化参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;nosHelper&quot; class=&quot;atranslate.common.NosHelper&quot; init-method=&quot;init&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;accessKey&quot; value=&quot;$&#123;accessKey&#125;&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;secretKey&quot; value=&quot;$&#123;secretKey&#125;&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;bucketName&quot; value=&quot;@NOS_BUCKET@&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;fileOrderMailRender&quot; ref=&quot;fileOrderMailRender&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;connectionFactory&quot; ref=&quot;connectionFactory&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;nosExchangeName&quot; value=&quot;@NOS_EXCHANGE@&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;nosRoutingKey&quot; value=&quot;@NOS_ROUTINGKEY@&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;nosQueueName&quot; value=&quot;@NOS_QUEUE@&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>遇到<code>${}</code>符号的去application.properties里面找，遇到<code>@@</code>的去filter.properties里面找。</p>
<p>Ribbon是一个基于HTTP和TCP客户端的负载均衡器，Ribbon可以在通过客户端中配置的ribbonServerList服务端列表去轮询访问以达到均衡负载的作用。</p>
<p>在基于Eureka的springcloud中使用ribbon只需要3步走：</p>
<ol>
<li>首先布置好Eureka服务和生产者服务（P）</li>
<li>在消费者微服务（C）中添加如下的配置文件（或者写在入口Application文件里面）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.hts.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author qinxue</span><br><span class="line"> * @date 2018/8/13 17:55</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class RibbonConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    @LoadBalanced</span><br><span class="line">    RestTemplate restTemplate() &#123;</span><br><span class="line">        return new RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在需要用到的地方</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package com.hts.controller;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by panxiong on 2018/7/9</span><br><span class="line"> * mod: qinxue</span><br><span class="line"> * @author panxiong</span><br><span class="line"> * @Description  CAT流程管理，创建任务，查看任务列表，指派订单，设置权限等。</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/task&quot;)</span><br><span class="line">public class TaskController extends BaseController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOG = LoggerFactory.getLogger(TaskController.class);</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;fanyiTermServerTest&#125;&quot;)</span><br><span class="line">    private String fanyiTermServerUrl;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;测试调用术语库中的api&quot;, notes = &quot;测试调用术语库中的api&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/testTerm&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">    public @ResponseBody String hi() &#123;</span><br><span class="line">        LOG.info(fanyiTermServerUrl);</span><br><span class="line">        return restTemplate.getForObject(fanyiTermServerUrl +  &quot;/termApi/getAllUserTermsInfo&quot;, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在application.properties里面配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"># FANYI-TERM-SERVER-TEST:20100</span><br><span class="line">fanyiTermServerTest=http://FANYI-TERM-SERVER-TEST/</span><br></pre></td></tr></table></figure>
<p>需要特别注意的是，请求的url一定不能直接写死地址，而要写微服务的名字！！！不然会报错找不到微服务实例。</p>
<p>如果不想结合eureka，那么可以参考spring的官网： <code>https://spring.io/guides/gs/client-side-load-balancing/</code>，里面说了，默认ribbon是从eureka注册的服务中获取服务列表。如果想自己指定，也是可以的。</p>
<blockquote>
<p>Load balancers in Ribbon normally get their server lists from a Netflix Eureka service registry…. we are skipping Eureka, so we set the ribbon.eureka.enabled property to false and instead give Ribbon a static listOfServers. ServerListRefreshInterval is the interval, in milliseconds, between refreshes of Ribbon’s service list.</p>
</blockquote>
<p>在微服务中，多个服务之间的通信可以靠http restful api实现，当然也可以使用rabbit mq。</p>
<h4 id="8-14"><a href="#8-14" class="headerlink" title="8-14"></a>8-14</h4><p>redis集群是由多个节点组成，它们之间时刻保持通信更新节点的信息。节点会负责相应的槽，当有客户端请求时，会根据键的信息来判断属于哪个槽，进而决定给哪个节点处理。集群中所有节点分为主节点和从节点，当主节点下线时，会从从节点中选举出主节点代替下线的那个节点。选举的算法为raft算法。从而实现故障转移。</p>
<p>关键词：主从复制、故障转移、选举新节点</p>
<p>在springcloud中使用zuul实现网关路由、过滤的功能分为3步走：</p>
<ol>
<li>编写filter类，在run里面写具体的业务逻辑等等</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.hts.filters;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author qinxue</span><br><span class="line"> * @date 2018/8/14 12:02</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import com.netflix.zuul.context.RequestContext;</span><br><span class="line">import com.netflix.zuul.ZuulFilter;</span><br><span class="line"></span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">public class SimpleFilter extends ZuulFilter &#123;</span><br><span class="line"></span><br><span class="line">    private static Logger log = LoggerFactory.getLogger(SimpleFilter.class);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String filterType() &#123;</span><br><span class="line">        return &quot;pre&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int filterOrder() &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldFilter() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object run() &#123;</span><br><span class="line">        RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">        HttpServletRequest request = ctx.getRequest();</span><br><span class="line"></span><br><span class="line">        log.info(String.format(&quot;%s request to %s&quot;, request.getMethod(), request.getRequestURL().toString()));</span><br><span class="line"></span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在入口application里面添加<code>@EnableZuulProxy</code>注解，同时添加过滤器的bean初始化</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">...</span><br><span class="line">@EnableZuulProxy</span><br><span class="line">@MapperScan(&quot;cat.storage&quot;)</span><br><span class="line">public class FanyiEditApplication &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public SimpleFilter simpleFilter() &#123;</span><br><span class="line">        return new SimpleFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(FanyiEditApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>这样就可以访问了，注意服务名<code>FANYI-TERM-SERVER-TEST</code>要换成小写访问！！！可以从日志中看出来。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http://nc060x.corp.youdao.com:25388/fanyi-term-server-test/termApi/getAllUserTermsInfo</span><br><span class="line">[2018-08-14 13:18:40.738] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/fanyi-term-server-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.738] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/hts-task-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.738] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/fanyi-edit-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.739] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/hts-config-server-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.739] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/hts-log-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.739] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/fanyi-term-client-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.740] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/hts-service-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">[2018-08-14 13:18:40.740] [http-nio-25388-exec-1] [INFO] [org.springframework.cloud.netflix.zuul.web.ZuulHandlerMapping:362] -- Mapped URL path [/hts-service-monitor-test/**] onto handler of type [class org.springframework.cloud.netflix.zuul.web.ZuulController]</span><br><span class="line">...</span><br><span class="line">[2018-08-14 13:25:28.137] [http-nio-25388-exec-7] [INFO] [com.hts.filters.SimpleFilter:39] -- GET request to http://nc060x.corp.youdao.com:25388/fanyi-term-server-test/termApi/getAllUserTermsInfo</span><br></pre></td></tr></table></figure>
<p>终于理解正向代理和反向代理了。而且往往反向代理结合负载均衡“味道更佳”</p>
<p>注解的注入其实也是和Spring IoC容器相关的，底层原理都可以归为反射机制。</p>
<p>@Autowire和@Resource的区别主要是：前者主要按照类型来注入，而后者按照name来注入。</p>
<p>mysql中的聚合函数只是统计某列的值并返回。聚合函数面向一组数据，对数据进行聚合运算后返回单一的值。</p>
<h4 id="8-16"><a href="#8-16" class="headerlink" title="8-16"></a>8-16</h4><p>出现这个错误，表示当前目录磁盘满了，可以删除一些文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svn: Error writing to &apos;.&apos;</span><br><span class="line">svn: Can&apos;t write to file &apos;.svn/tmp/entries&apos;: No space left on device</span><br></pre></td></tr></table></figure>
<p>版本回退，表示从当前的616464回退到616463，和merge一样的，只是把版本号反过来，把2.0.6xx合并到当前目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn merge -r 616464:616463 https://dev.corp.youdao.com/svn/outfox/incubator/rengong/milestones/2.0.6xx .</span><br></pre></td></tr></table></figure>
<p>ant online和ant dist-web的作用是替换为上线版本。所以这个时候就不能再动2.0.6xx那个文件夹了。如果在里面做一些提交的操作就会把测试环境上的一些配置改动为线上的配置了。</p>
<h4 id="8-17"><a href="#8-17" class="headerlink" title="8-17"></a>8-17</h4><p>linux上查看磁盘的使用情况，<code>df -h</code>后面可以指定文件夹的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 fanyi-terminology]$ df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda1              50G  8.7G   38G  19% /</span><br><span class="line">tmpfs                  24G     0   24G   0% /dev/shm</span><br><span class="line">/dev/sda5             4.9G   15M  4.7G   1% /tmp</span><br><span class="line">/dev/sda2              15G  1.5G   13G  11% /var</span><br><span class="line">/dev/sda6             382G  363G   17M 100% /disk1</span><br><span class="line">/dev/sdb1             452G  1.6G  450G   1% /disk2</span><br><span class="line">/dev/sdc1             459G  1.6G  457G   1% /disk3</span><br><span class="line">/dev/sdd1             688G  198M  688G   1% /disk4</span><br><span class="line">10.168.11.145:/home   452G   72G  357G  17% /home</span><br><span class="line">10.168.3.255:/global  2.7T 1006G  1.6T  39% /global</span><br></pre></td></tr></table></figure>
<p>查看当前目录下所有文件夹的磁盘使用量，同样后面可以指定文件夹的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 disk1]$ du --max-depth=1 -h</span><br><span class="line">230M	./zookeeper-3.4.6</span><br><span class="line">70G	./atranslate</span><br><span class="line">3.2G	./qinxue</span><br><span class="line">164G	./at.test</span><br><span class="line">308M	./elasticData</span><br><span class="line">32K	./fanyiweb</span><br><span class="line">du: cannot read directory `./lost+found&apos;: Permission denied</span><br><span class="line">16K	./lost+found</span><br><span class="line">17M	./ydagent</span><br><span class="line">111M	./rabbitmq-server-3.5.6</span><br><span class="line">41M	./dubbo-monitor</span><br><span class="line">54M	./kafka_2.11-0.11.0.1</span><br><span class="line">70G	./at.front</span><br><span class="line">8.1M	./dict_handwrite_new</span><br><span class="line">612K	./panxiong</span><br><span class="line">637M	./software</span><br><span class="line">81M	./tmp</span><br><span class="line">34M	./serverLog</span><br><span class="line">356M	./otp_src_R16B02</span><br><span class="line">55G	./zhaoyh</span><br><span class="line">20K	./.dubbo</span><br><span class="line">du: cannot read directory `./install/nginx/data/fastcgi&apos;: Permission denied</span><br><span class="line">du: cannot read directory `./install/nginx/data/proxy&apos;: Permission denied</span><br><span class="line">du: cannot read directory `./install/nginx/fastcgi-cache&apos;: Permission denied</span><br><span class="line">21M	./install</span><br><span class="line">32K	./hts-userThermogram</span><br><span class="line">30M	./xmonitor</span><br><span class="line">362G	.</span><br></pre></td></tr></table></figure>
<p>使用<code>du -sh</code>可以查看某个文件夹的大小，同样后面可以指定文件夹的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 disk1]$ du -sh qinxue/</span><br><span class="line">3.2G	qinxue/</span><br></pre></td></tr></table></figure>
<p>当使用getForObject时，如果get请求带参数，那么url一定要带占位符，<code>getTermsByUserId?userId={userId}</code>，不能是空的：<code>getTermsByUserId</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">long userId = -1252383168532848071L;</span><br><span class="line">Map&lt;String, Object&gt; getMap = new HashMap&lt;&gt;();</span><br><span class="line">getMap.put(&quot;userId&quot;, userId);</span><br><span class="line">JSONObject result = JSONObject.parseObject(restTemplate.getForObject(fanyiTermServerUrl</span><br><span class="line">                +  &quot;/termApi/getTermsByUserId?userId=&#123;userId&#125;&quot;, String.class, getMap));</span><br></pre></td></tr></table></figure>
<h4 id="8-21"><a href="#8-21" class="headerlink" title="8-21"></a>8-21</h4><p>到这边实习已经恰好2个月了。这2个月主要做了以下的事情</p>
<ol>
<li>修改server端的代码，添加功能，这里涉及到rpc远程调用，所以不能简单地在web端或是分单系统上改。整个server端是基于dubbo部署的。</li>
<li>增加一个多文件上传的功能。涉及到简单的业务处理。对多个文件进行压缩，然后保存。</li>
<li>官网的api功能开发，这一块比较有意思，主要写api接口，方便第三方使用，接触到了api接口开发的主流思想，即采用publiKey，和私钥、再加时间戳，与sha1签名的方式，保证接口的安全性（包括可靠性、一致性）</li>
<li>积分活动的开发，主要涉及到新增表、写storage层的数据库的增删查改的功能。</li>
<li>译后编辑系统的开发，也是一块比较感兴趣的内容，主要使用到了Spring Cloud的框架，包括Eureka的服务注册与发现，ribbon的负载均衡以及zuul的网关、路由功能。而整个的消息总线是基于RabbitMQ的。接着就是写接口、写增删查改吧。</li>
</ol>
<h4 id="8-22"><a href="#8-22" class="headerlink" title="8-22"></a>8-22</h4><p>如果想要让.sh文件可以直接运行<code>./xxx.sh</code>，需要给它加上可执行的权限即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x xxx.sh</span><br><span class="line">@ApiOperation(value = &quot;创建术语库&quot;, notes = &quot;pm点击创建术语库自动生成一个术语库&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/createTerm&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public String createTerm() &#123;</span><br><span class="line">        JSONObject json = new JSONObject();</span><br><span class="line">        Map&lt;String, Object&gt; postMap = new HashMap&lt;&gt;();</span><br><span class="line">        postMap.put(&quot;userId&quot;, getUserId());</span><br><span class="line">        // todo 若是微信用户则显示为微信id</span><br><span class="line">        postMap.put(&quot;termLibraryName&quot;, getEmail());</span><br><span class="line">        JSONObject result = JSONObject.parseObject(restTemplate.postForObject(fanyiTermServerUrl</span><br><span class="line">                +  &quot;/termApi/addUserTransTermSys&quot;, postMap, String.class));</span><br><span class="line">        if (Integer.parseInt(result.get(&quot;statusCode&quot;).toString()) == 200) &#123;</span><br><span class="line">            addOK(json);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            addErrorInfo(json, ErrorCodeEnum.SYSTEM_ERR);</span><br><span class="line">        &#125;</span><br><span class="line">        return json.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;下载术语库&quot;, notes = &quot;下载术语库的Excel表格&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/downloadTermAsExcel&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public String downloadTermAsExcel(@RequestParam(&quot;userId&quot;) long userId, HttpServletResponse response) &#123;</span><br><span class="line">        JSONObject json = new JSONObject();</span><br><span class="line">        List&lt;String&gt; headers = Arrays.asList(&quot;编号&quot;, &quot;订单号&quot;, &quot;提供者Id&quot;, &quot;源语言&quot;, &quot;目标语言&quot;, &quot;源术语&quot;, &quot;目标术语&quot;, &quot;领域&quot;);</span><br><span class="line">        JSONObject result = JSONObject.parseObject(restTemplate.getForObject(fanyiTermServerUrl</span><br><span class="line">                +  &quot;/termApi/getTermsByUserId?userId=&#123;userId&#125;&quot;, String.class, userId));</span><br><span class="line">        List&lt;JSONObject&gt; hashMapList = JSONArray.parseArray(result.get(&quot;result&quot;).toString()).toJavaList(JSONObject.class);</span><br><span class="line">        List&lt;List&lt;Object&gt;&gt; excelData = new ArrayList&lt;&gt;();</span><br><span class="line">        for (JSONObject o : hashMapList) &#123;</span><br><span class="line">            List&lt;Object&gt; record = Arrays.asList(o.get(&quot;id&quot;), o.get(&quot;htsOrderId&quot;), o.get(&quot;providerId&quot;),</span><br><span class="line">                    o.get(&quot;srcLang&quot;), o.get(&quot;desLang&quot;), o.get(&quot;srcTerm&quot;), o.get(&quot;desTerm&quot;), o.get(&quot;areaInfo&quot;));</span><br><span class="line">            excelData.add(record);</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            ExcelUtils.exportExcel(response, &quot;术语导出表_&quot; + userId + &quot;.xlsx&quot;, headers, excelData);</span><br><span class="line">            addOK(json);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            LOG.error(&quot;export excel failed!&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return json.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/upload&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">    public String upload() &#123;</span><br><span class="line">        return &quot;file/uploadExcel&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;导入术语库&quot;, notes = &quot;从Excel表中批量导入到&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/importTermFromExcel&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public String importTermFromExcel(@RequestParam(&quot;orderId&quot;) long orderId, @RequestParam(&quot;file&quot;) MultipartFile file) &#123;</span><br><span class="line">        JSONObject json = new JSONObject();</span><br><span class="line">        // 1. 加载用户传入的文件</span><br><span class="line">        String fileName = file.getOriginalFilename();</span><br><span class="line">        if (!fileName.matches(&quot;^.+\\.(?i)(xls)$&quot;) &amp;&amp; !fileName.matches(&quot;^.+\\.(?i)(xlsx)$&quot;)) &#123;</span><br><span class="line">            addErrorInfo(json, ErrorCodeEnum.PARAMETER_ERR);</span><br><span class="line">            return json.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        JSONArray excelData = new JSONArray();</span><br><span class="line">        try &#123;</span><br><span class="line">            // 2. 读取Excel文件的内容</span><br><span class="line">            excelData = ExcelUtils.batchImport(fileName, file);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            LOG.error(&quot;import excel failed!&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        if (null == excelData) &#123;</span><br><span class="line">            addErrorInfo(json, ErrorCodeEnum.PARAMETER_ERR);</span><br><span class="line">            return json.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        // 3. 把术语添加到数据库中</span><br><span class="line">        JSONObject postJson = new JSONObject();</span><br><span class="line">        postJson.put(&quot;userId&quot;, 1234456);</span><br><span class="line">        postJson.put(&quot;orderId&quot;, orderId);</span><br><span class="line">        postJson.put(&quot;terms&quot;, excelData);</span><br><span class="line">        // 注意，一定要使用postForObject来获取服务器那边传来的JSONObject，而不是用postForEntity，否则会传来很多额外的东西</span><br><span class="line">        JSONObject result = JSONObject.parseObject(restTemplate.postForObject(fanyiTermServerUrl</span><br><span class="line">                +  &quot;/termApi/addMultiTerms&quot;, postJson, String.class));</span><br><span class="line">        if (!isValidResponse(json, result)) return json.toString();</span><br><span class="line"></span><br><span class="line">        // 4. 返回术语的json到前端，动态刷新页面</span><br><span class="line">        json.put(&quot;termData&quot;, excelData);</span><br><span class="line">        addOK(json);</span><br><span class="line">        return json.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;查询某个用户的术语表&quot;, notes = &quot;查询某个用户的所有术语&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/getUserTermsList&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public String getUserTermsList(@RequestParam(value = &quot;userId&quot;) long userId) &#123;</span><br><span class="line">        JSONObject json = new JSONObject();</span><br><span class="line">        Map&lt;String, Object&gt; getMap = new HashMap&lt;&gt;();</span><br><span class="line">        getMap.put(&quot;userId&quot;, userId);</span><br><span class="line"></span><br><span class="line">        // 1. 获取该用户术语库的相关信息</span><br><span class="line">        JSONObject userTermLibraryInfo = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            userTermLibraryInfo = JSONObject.parseObject(restTemplate.getForObject(fanyiTermServerUrl</span><br><span class="line">                    + &quot;/termApi/getUserTermByUserId?userId=&#123;userId&#125;&quot;, String.class, getMap));</span><br><span class="line">            if (!isValidResponse(json, userTermLibraryInfo)) return json.toString();</span><br><span class="line">        &#125; catch (RestClientException e) &#123;</span><br><span class="line">            LOG.error(&quot;getUserTermByUserId: &quot; + userId + &quot;failed!&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 2. 获取该用户的所有术语</span><br><span class="line">        // 一定要这样写，url中要加入占位符，不能什么参数都不带</span><br><span class="line">        JSONObject userTermsList = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            userTermsList = JSONObject.parseObject(restTemplate.getForObject(fanyiTermServerUrl</span><br><span class="line">                    +  &quot;/termApi/getTermsByUserId?userId=&#123;userId&#125;&quot;, String.class, getMap));</span><br><span class="line">            if (!isValidResponse(json, userTermsList)) return json.toString();</span><br><span class="line">        &#125; catch (RestClientException e) &#123;</span><br><span class="line">            LOG.error(&quot;getTermsByUserId: &quot; + userId + &quot;failed!&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        json.put(&quot;userTermLibraryInfo&quot;, userTermLibraryInfo.get(&quot;result&quot;));</span><br><span class="line">        json.put(&quot;termsList&quot;, userTermsList.get(&quot;result&quot;));</span><br><span class="line">        addOK(json);</span><br><span class="line">        return json.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8.23</p>
<p>当在springboot项目中没有添加thymleaf依赖时，并且没有声明一个ViewResolver时，Spring就会默认注册一个InternalResourceViewResolver，它会创建一个JstlView的实例来渲染View。后面可能会出现死循环。所以要么添加thymleaf依赖，让它来解决，或者自己声明一个ViewResolver。</p>
<p>nio中最常使用的是多路复用，它是非阻塞的。最主要的有3个组件</p>
<ol>
<li>Selector（多路复用选择器，类似于netty里面的EventLoop，可以看做是一个线程）</li>
<li>Channel（封装了Socket），注意一个Channel只能注册到一个Selector上，一个Selector可以被多个Channel注册，并监听这些Channel。</li>
<li>ByteBuffer（用于存取数据）</li>
</ol>
<p>可以类比为一个快递站。一开始快递站的主管一个人负责所有的快递签收，当一卡车的货运过来的时候，它就会把这些快递全部收取。有客户来取得时候，他就得在所有的快递里面一个一个找。</p>
<p>接着，主管想到了一个好的方法。将不同的快递分门别类地摆放，比如申通放在一个架子上，圆通放一个架子，顺丰放一个等等。这时客户来取得时候，他只需要去相应的架子上去找。</p>
<p>后来，主管发现，这样一来，当客户多的时候，他忙不过来，于是，他雇佣了3个员工。这3个人分别负责不同的快递。A负责圆通、申通、中通，B负责顺丰，C负责韵达。这时就好多了。</p>
<p>可以看到，每一件快递可以看做是字节流。而货车可以看作ByteBuffer。每一条快递通道看作Channel，ABC就是Selector。</p>
<p>今天重新安装了一下brew，之前通过brew安装的都不在了。。。Cellar底下为空</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">qx:Cellar XFade$ ll</span><br><span class="line">qx:~ XFade$ brew install cmake</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/cmake-3.12.1.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring cmake--3.12.1.high_sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Emacs Lisp files have been installed to:</span><br><span class="line">  /usr/local/share/emacs/site-lisp/cmake</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/cmake/3.12.1: 2,417 files, 33.6MB</span><br><span class="line"></span><br><span class="line">qx:~ XFade$ brew install redis</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/redis-4.0.11.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring redis--4.0.11.high_sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">To have launchd start redis now and restart at login:</span><br><span class="line">  brew services start redis</span><br><span class="line">Or, if you don&apos;t want/need a background service you can just run:</span><br><span class="line">  redis-server /usr/local/etc/redis.conf</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/redis/4.0.11: 13 files, 2.8MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">qx:~ XFade$ brew install rabbitmq</span><br><span class="line">==&gt; Installing dependencies for rabbitmq: openssl, jpeg, libpng, libtiff, wxmac, erlang</span><br><span class="line">==&gt; Installing rabbitmq dependency: openssl</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2p.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring openssl--1.0.2p.high_sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">A CA file has been bootstrapped using certificates from the SystemRoots</span><br><span class="line">keychain. To add additional certificates (e.g. the certificates added in</span><br><span class="line">the System keychain), place .pem files in</span><br><span class="line">  /usr/local/etc/openssl/certs</span><br><span class="line"></span><br><span class="line">and run</span><br><span class="line">  /usr/local/opt/openssl/bin/c_rehash</span><br><span class="line"></span><br><span class="line">openssl is keg-only, which means it was not symlinked into /usr/local,</span><br><span class="line">because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.</span><br><span class="line"></span><br><span class="line">If you need to have openssl first in your PATH run:</span><br><span class="line">  echo &apos;export PATH=&quot;/usr/local/opt/openssl/bin:$PATH&quot;&apos; &gt;&gt; ~/.bash_profile</span><br><span class="line"></span><br><span class="line">For compilers to find openssl you may need to set:</span><br><span class="line">  export LDFLAGS=&quot;-L/usr/local/opt/openssl/lib&quot;</span><br><span class="line">  export CPPFLAGS=&quot;-I/usr/local/opt/openssl/include&quot;</span><br><span class="line"></span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/openssl/1.0.2p: 1,793 files, 12.3MB</span><br><span class="line">==&gt; Installing rabbitmq dependency: jpeg</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/jpeg-9c.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring jpeg--9c.high_sierra.bottle.tar.gz</span><br><span class="line">🍺  /usr/local/Cellar/jpeg/9c: 21 files, 724.5KB</span><br><span class="line">==&gt; Installing rabbitmq dependency: libpng</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/libpng-1.6.35.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring libpng--1.6.35.high_sierra.bottle.tar.gz</span><br><span class="line">🍺  /usr/local/Cellar/libpng/1.6.35: 26 files, 1.2MB</span><br><span class="line">==&gt; Installing rabbitmq dependency: libtiff</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/libtiff-4.0.9_4.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring libtiff--4.0.9_4.high_sierra.bottle.tar.gz</span><br><span class="line">🍺  /usr/local/Cellar/libtiff/4.0.9_4: 246 files, 3.5MB</span><br><span class="line">==&gt; Installing rabbitmq dependency: wxmac</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/wxmac-3.0.4_1.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring wxmac--3.0.4_1.high_sierra.bottle.tar.gz</span><br><span class="line">🍺  /usr/local/Cellar/wxmac/3.0.4_1: 813 files, 23.8MB</span><br><span class="line">==&gt; Installing rabbitmq dependency: erlang</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/erlang-21.0.5.high_sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring erlang--21.0.5.high_sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Man pages can be found in:</span><br><span class="line">  /usr/local/opt/erlang/lib/erlang/man</span><br><span class="line"></span><br><span class="line">Access them with `erl -man`, or add this directory to MANPATH.</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/erlang/21.0.5: 5,668 files, 271.7MB</span><br><span class="line">==&gt; Installing rabbitmq</span><br><span class="line">==&gt; Downloading https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.7/rabbitmq-server-generic-unix-3.7.7.tar.xz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; /usr/bin/unzip -qq -j /usr/local/Cellar/rabbitmq/3.7.7_1/plugins/rabbitmq_management-3.7.7.ez rabbitmq_management-3.7.7/priv/www/cli/rabbitmqadmin</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Management Plugin enabled by default at http://localhost:15672</span><br><span class="line"></span><br><span class="line">Bash completion has been installed to:</span><br><span class="line">  /usr/local/etc/bash_completion.d</span><br><span class="line"></span><br><span class="line">To have launchd start rabbitmq now and restart at login:</span><br><span class="line">  brew services start rabbitmq</span><br><span class="line">Or, if you don&apos;t want/need a background service you can just run:</span><br><span class="line">  rabbitmq-server</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/rabbitmq/3.7.7_1: 233 files, 13.3MB, built in 10 seconds</span><br><span class="line">==&gt; Caveats</span><br><span class="line">==&gt; openssl</span><br><span class="line">A CA file has been bootstrapped using certificates from the SystemRoots</span><br><span class="line">keychain. To add additional certificates (e.g. the certificates added in</span><br><span class="line">the System keychain), place .pem files in</span><br><span class="line">  /usr/local/etc/openssl/certs</span><br><span class="line"></span><br><span class="line">and run</span><br><span class="line">  /usr/local/opt/openssl/bin/c_rehash</span><br><span class="line"></span><br><span class="line">openssl is keg-only, which means it was not symlinked into /usr/local,</span><br><span class="line">because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.</span><br><span class="line"></span><br><span class="line">If you need to have openssl first in your PATH run:</span><br><span class="line">  echo &apos;export PATH=&quot;/usr/local/opt/openssl/bin:$PATH&quot;&apos; &gt;&gt; ~/.bash_profile</span><br><span class="line"></span><br><span class="line">For compilers to find openssl you may need to set:</span><br><span class="line">  export LDFLAGS=&quot;-L/usr/local/opt/openssl/lib&quot;</span><br><span class="line">  export CPPFLAGS=&quot;-I/usr/local/opt/openssl/include&quot;</span><br><span class="line"></span><br><span class="line">==&gt; erlang</span><br><span class="line">Man pages can be found in:</span><br><span class="line">  /usr/local/opt/erlang/lib/erlang/man</span><br><span class="line"></span><br><span class="line">Access them with `erl -man`, or add this directory to MANPATH.</span><br><span class="line">==&gt; rabbitmq</span><br><span class="line">Management Plugin enabled by default at http://localhost:15672</span><br><span class="line"></span><br><span class="line">Bash completion has been installed to:</span><br><span class="line">  /usr/local/etc/bash_completion.d</span><br><span class="line"></span><br><span class="line">To have launchd start rabbitmq now and restart at login:</span><br><span class="line">  brew services start rabbitmq</span><br><span class="line">Or, if you don&apos;t want/need a background service you can just run:</span><br><span class="line">  rabbitmq-server</span><br><span class="line">qx:~ XFade$</span><br></pre></td></tr></table></figure>
<p>将redis-3.2.11文件夹下面的redis.conf文件夹修改一下，修改以下几个属性，不能只修改前面3个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">port 7000 //节点端口</span><br><span class="line">daemonize yes //配置redis作为守护进程运行，默认情况下，redis不是作为守护进程运行的</span><br><span class="line">cluster-enabled yes  //是否开启集群</span><br><span class="line">cluster-config-file nodes-7000.conf   //该节点的对应的节点配置文件</span><br><span class="line">cluster-node-timeout 5000 //集群超时时间</span><br><span class="line">appendonly yes //存储方式，</span><br><span class="line">qx:redis-cluster XFade$ sudo gem install redis</span><br><span class="line">Password:</span><br><span class="line">Fetching: redis-4.0.2.gem (100%)</span><br><span class="line">Successfully installed redis-4.0.2</span><br><span class="line">Parsing documentation for redis-4.0.2</span><br><span class="line">Installing ri documentation for redis-4.0.2</span><br><span class="line">Done installing documentation for redis after 1 seconds</span><br><span class="line">1 gem installed</span><br><span class="line">qx:redis-cluster XFade$ ./redis-trib.rb create --replicas 1 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006</span><br><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">127.0.0.1:7001</span><br><span class="line">127.0.0.1:7002</span><br><span class="line">127.0.0.1:7003</span><br><span class="line">Adding replica 127.0.0.1:7005 to 127.0.0.1:7001</span><br><span class="line">Adding replica 127.0.0.1:7006 to 127.0.0.1:7002</span><br><span class="line">Adding replica 127.0.0.1:7004 to 127.0.0.1:7003</span><br><span class="line">&gt;&gt;&gt; Trying to optimize slaves allocation for anti-affinity</span><br><span class="line">[WARNING] Some slaves are in the same host as their master</span><br><span class="line">M: a85f679e5762cff384b5db410191ad7334972834 127.0.0.1:7001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: a6c8f4f34a823e5475ebc6397b4f8986c1f5cc84 127.0.0.1:7002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: 2636533a62ec6f07979e10e362b6bc68c0fd451f 127.0.0.1:7003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 4e5dd8f56cbe10cfd4b83a0d507216aafbf62f17 127.0.0.1:7004</span><br><span class="line">   replicates a85f679e5762cff384b5db410191ad7334972834</span><br><span class="line">S: c1b0f7e0199fb7f82a801b41671c3b7488ffbb40 127.0.0.1:7005</span><br><span class="line">   replicates a6c8f4f34a823e5475ebc6397b4f8986c1f5cc84</span><br><span class="line">S: fd9b477c0c14df9a130122fc0c2c84005f3b5ff3 127.0.0.1:7006</span><br><span class="line">   replicates 2636533a62ec6f07979e10e362b6bc68c0fd451f</span><br><span class="line">Can I set the above configuration? (type &apos;yes&apos; to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting for the cluster to join...</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:7001)</span><br><span class="line">M: a85f679e5762cff384b5db410191ad7334972834 127.0.0.1:7001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: a6c8f4f34a823e5475ebc6397b4f8986c1f5cc84 127.0.0.1:7002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: c1b0f7e0199fb7f82a801b41671c3b7488ffbb40 127.0.0.1:7005</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates a6c8f4f34a823e5475ebc6397b4f8986c1f5cc84</span><br><span class="line">S: 4e5dd8f56cbe10cfd4b83a0d507216aafbf62f17 127.0.0.1:7004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates a85f679e5762cff384b5db410191ad7334972834</span><br><span class="line">S: fd9b477c0c14df9a130122fc0c2c84005f3b5ff3 127.0.0.1:7006</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 2636533a62ec6f07979e10e362b6bc68c0fd451f</span><br><span class="line">M: 2636533a62ec6f07979e10e362b6bc68c0fd451f 127.0.0.1:7003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check for open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">qx:redis-cluster XFade$</span><br><span class="line">qx:bin XFade$ ./redis-cli -h 127.0.0.1 -p 7001</span><br><span class="line">127.0.0.1:7001&gt; set name qinxue</span><br><span class="line">(error) MOVED 5798 127.0.0.1:7002</span><br><span class="line">127.0.0.1:7001&gt; quit</span><br><span class="line">qx:bin XFade$ ./redis-cli -h 127.0.0.1 -p 7002</span><br><span class="line">127.0.0.1:7002&gt; get name</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:7002&gt; set name qinxue</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:7002&gt; get name</span><br><span class="line">&quot;qinxue&quot;</span><br><span class="line">127.0.0.1:7002&gt; quit</span><br><span class="line">qx:bin XFade$ ./redis-cli -h 127.0.0.1 -p 7001</span><br><span class="line">127.0.0.1:7001&gt; get name</span><br><span class="line">(error) MOVED 5798 127.0.0.1:7002</span><br><span class="line">127.0.0.1:7001&gt;</span><br></pre></td></tr></table></figure>
<p>8.24 关于Redis中的使用，如果需要操作类对象，那么除了要implement序列化之外，还要加一个默认的构造函数，即不带任何参数的构造函数。否则会报错无法解析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Goods implements Serializable &#123;</span><br><span class="line">    private long id;</span><br><span class="line">    private String goodsName;</span><br><span class="line">    private String goodsTitle;</span><br><span class="line">    private String goodsImg;</span><br><span class="line">    private String goodsDetail;</span><br><span class="line">    private BigDecimal goodsPrice;</span><br><span class="line">    private int goodsStock;</span><br><span class="line"></span><br><span class="line">    public Goods() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在客户端中查询显示中文：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli --raw -h 127.0.0.1 -p 7001</span><br><span class="line"></span><br><span class="line">[&quot;java.util.ArrayList&quot;, [&#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 1,</span><br><span class="line">	&quot;goodsName&quot;: &quot;牙膏&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;非常好用的牙膏&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;yagao.jpeg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;推荐，适合男女老少哈哈哈&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 12.80],</span><br><span class="line">	&quot;goodsStock&quot;: 1000</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 4,</span><br><span class="line">	&quot;goodsName&quot;: &quot;书本&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;Java并发编程&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;javacia.jpg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;很棒的一本书&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 89.60],</span><br><span class="line">	&quot;goodsStock&quot;: 2324</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 5,</span><br><span class="line">	&quot;goodsName&quot;: &quot;裤子&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;女生裤子&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;kuzi.jpg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;很漂亮哈哈哈哈&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 78.00],</span><br><span class="line">	&quot;goodsStock&quot;: 987</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 6,</span><br><span class="line">	&quot;goodsName&quot;: &quot;拖鞋&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;哈哈哈拖鞋&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;tuoxie.jpeg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;拖鞋啊啊啊&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 34.00],</span><br><span class="line">	&quot;goodsStock&quot;: 876</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 8,</span><br><span class="line">	&quot;goodsName&quot;: &quot;水果&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;新鲜的水果&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;水果.jpeg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;新鲜的水果，新疆特运&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 23.00],</span><br><span class="line">	&quot;goodsStock&quot;: 984</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 9,</span><br><span class="line">	&quot;goodsName&quot;: &quot;雨伞&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;黑色雨伞&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;雨伞.jpeg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;好用的、耐用的雨伞&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 88.00],</span><br><span class="line">	&quot;goodsStock&quot;: 965</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 10,</span><br><span class="line">	&quot;goodsName&quot;: &quot;书包&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;title&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;shubao.jpg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;detail&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 23.40],</span><br><span class="line">	&quot;goodsStock&quot;: 457</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	&quot;@class&quot;: &quot;com.youdao.entity.Goods&quot;,</span><br><span class="line">	&quot;id&quot;: 12,</span><br><span class="line">	&quot;goodsName&quot;: &quot;书包&quot;,</span><br><span class="line">	&quot;goodsTitle&quot;: &quot;title&quot;,</span><br><span class="line">	&quot;goodsImg&quot;: &quot;shubao.jpg&quot;,</span><br><span class="line">	&quot;goodsDetail&quot;: &quot;detail&quot;,</span><br><span class="line">	&quot;goodsPrice&quot;: [&quot;java.math.BigDecimal&quot;, 23.40],</span><br><span class="line">	&quot;goodsStock&quot;: 457</span><br><span class="line">&#125;]]</span><br></pre></td></tr></table></figure>
<p>依赖注入时的类型一定要存在，在config文件中返回的一定要是这个类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Field threadPool in com.hts.helper.NosHelper required a bean of type &apos;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&apos; that could not be found.</span><br><span class="line">@Bean(name = &quot;mailSender&quot;)</span><br><span class="line">public MailSender getMailSender() &#123;</span><br><span class="line">    LOG.info(&quot;Config MailSender...&quot;);</span><br><span class="line">    MailSender mailSender = new MailSender();</span><br><span class="line">    // todo 写入配置文件</span><br><span class="line">    mailSender.setUse163mail(false);</span><br><span class="line">    mailSender.setSmtpServer(&quot;dev&quot;);</span><br><span class="line">    mailSender.setUsername(&quot;fanyi-service@service.netease.com&quot;);</span><br><span class="line">    mailSender.setPassword(&quot;p0Z13Qy8EhwW&quot;);</span><br><span class="line">    mailSender.init();</span><br><span class="line">    return mailSender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>邮件相关的依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/javax.mail/mail --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.mail&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mail&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="8-29"><a href="#8-29" class="headerlink" title="8-29"></a>8-29</h4><p>mybatis中需要for循环，可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--按照领域搜索--&gt;</span><br><span class="line">&lt;select id=&quot;searchTermListByAreaInfo&quot; resultType=&quot;com.hts.model.Terminology&quot;&gt;</span><br><span class="line">    SELECT * FROM terminology</span><br><span class="line">    WHERE userId = #&#123;userId&#125; AND status &gt;= 0</span><br><span class="line">    AND</span><br><span class="line">    &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;areaInfoList&quot; open=&quot;(&quot; separator=&quot; or &quot; close=&quot;)&quot;&gt;</span><br><span class="line">        locate(#&#123;item&#125;, areaInfo)</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>在编写rabbitmq的consumer端时，老方法可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">public class FanyiEditConsumer &#123;</span><br><span class="line">    private static final Logger LOG = LoggerFactory.getLogger(FanyiEditConsumer.class);</span><br><span class="line"></span><br><span class="line">    private ConnectionFactory connectionFactory = null;</span><br><span class="line">    private static final String QUEUE_NAME = &quot;dsFanyieditQueue&quot;;</span><br><span class="line"></span><br><span class="line">    public void init() &#123;</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                Connection connection = null;</span><br><span class="line">                try &#123;</span><br><span class="line">                    connection = connectionFactory.newConnection();</span><br><span class="line">                    final Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">                    channel.queueDeclare(QUEUE_NAME, true, false, false, null);</span><br><span class="line">                    channel.queuePurge(QUEUE_NAME);</span><br><span class="line">                    channel.basicQos(1);</span><br><span class="line">                    LOG.info(&quot;waiting RPC requests...&quot;);</span><br><span class="line"></span><br><span class="line">                    Consumer consumer = new DefaultConsumer(channel) &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void handleDelivery(String consumerTag, Envelope envelope,</span><br><span class="line">                                                   AMQP.BasicProperties properties, byte[] body) throws IOException &#123;</span><br><span class="line">                            AMQP.BasicProperties replyProps = new AMQP.BasicProperties</span><br><span class="line">                                    .Builder()</span><br><span class="line">                                    .correlationId(properties.getCorrelationId())</span><br><span class="line">                                    .build();</span><br><span class="line">                            JSONObject response = new JSONObject();</span><br><span class="line">                            try &#123;</span><br><span class="line">                                String receivedMessage = new String(body,&quot;UTF-8&quot;);</span><br><span class="line">                                LOG.info(&quot;received: &quot; + receivedMessage);</span><br><span class="line">                                JSONObject result = JSONObject.fromObject(receivedMessage);</span><br><span class="line">                                String method = result.getString(&quot;method&quot;);</span><br><span class="line">                                switch (method) &#123;</span><br><span class="line">                                    case &quot;calculate&quot; :</span><br><span class="line">                                        response.put(&quot;result&quot;, String.valueOf(calculate(result.getInt(&quot;message&quot;))));</span><br><span class="line">                                        break;</span><br><span class="line">                                    case &quot;greeting&quot; :</span><br><span class="line">                                        response.put(&quot;result&quot;, greeting(result.getString(&quot;message&quot;)));</span><br><span class="line">                                        break;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            catch (RuntimeException e)&#123;</span><br><span class="line">                                LOG.error(&quot;RuntimeException...&quot;, e);</span><br><span class="line">                            &#125; finally &#123;</span><br><span class="line">                                LOG.info(response.toString());</span><br><span class="line">                                channel.basicPublish( &quot;&quot;, properties.getReplyTo(), replyProps,</span><br><span class="line">                                        response.toString().getBytes());</span><br><span class="line">                                channel.basicAck(envelope.getDeliveryTag(), false);</span><br><span class="line">                                // RabbitMq consumer worker thread notifies the RPC server owner thread</span><br><span class="line">                                synchronized(this) &#123;</span><br><span class="line">                                    this.notifyAll();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line"></span><br><span class="line">                    channel.basicConsume(QUEUE_NAME, false, consumer);</span><br><span class="line">                    // Wait and be prepared to consume the message from RPC client.</span><br><span class="line">                    while (true) &#123;</span><br><span class="line">                        synchronized(consumer) &#123;</span><br><span class="line">                            try &#123;</span><br><span class="line">                                consumer.wait();</span><br><span class="line">                            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                                LOG.error(&quot;InterruptedException...&quot;, e);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (IOException | TimeoutException e) &#123;</span><br><span class="line">                    LOG.error(&quot;IOException | TimeoutException...&quot;, e);</span><br><span class="line">                &#125;</span><br><span class="line">                finally &#123;</span><br><span class="line">                    if (connection != null) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            connection.close();</span><br><span class="line">                        &#125; catch (IOException e) &#123;</span><br><span class="line">                            LOG.error(&quot;close connection failed!&quot;, e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, &quot;fanyi-edit-thread&quot;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int calculate(int a) &#123;</span><br><span class="line">        return a * a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String greeting(String name) &#123;</span><br><span class="line">        return &quot;Hello, &quot; + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void setConnectionFactory(ConnectionFactory connectionFactory) &#123;</span><br><span class="line">        this.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而对于生产者来说，可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public JSONObject sendMessage(@RequestParam(value = &quot;method&quot;) String method, @RequestParam(value = &quot;message&quot;) String message) &#123;</span><br><span class="line">    JSONObject json = new JSONObject();</span><br><span class="line"></span><br><span class="line">    JSONObject toSend = new JSONObject();</span><br><span class="line">    toSend.put(&quot;method&quot;, method);</span><br><span class="line">    toSend.put(&quot;message&quot;, message);</span><br><span class="line">    // 以byte[]的格式传输，如果是convertSendAndReceive，就会涉及到Object与byte[]的转化，可能出现问题。</span><br><span class="line">    Message receivedMessage = amqpTemplate.sendAndReceive(dsExchangeName, dsRoutingKey,</span><br><span class="line">            new Message(toSend.toJSONString().getBytes(), new MessageProperties()));</span><br><span class="line">    String result;</span><br><span class="line">    try &#123;</span><br><span class="line">        result = new String(receivedMessage.getBody(), &quot;UTF-8&quot;);</span><br><span class="line">        json.put(&quot;result&quot;, JSONObject.parse(result));</span><br><span class="line">    &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">        LOG.info(&quot;message convert failed!&quot;, e);</span><br><span class="line">    &#125;</span><br><span class="line">    return addOK(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-12"><a href="#9-12" class="headerlink" title="9-12"></a>9-12</h4><p>export在shell脚本中设置环境变量失效的原因：<a href="https://blog.csdn.net/nemo2011/article/details/8472326" target="_blank" rel="noopener">https://blog.csdn.net/nemo2011/article/details/8472326</a></p>
<p>需要执行完sh文件后，加一个<code>source xxx.sh</code></p>
<p>这样就好了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[qinxue@nc060 fanyi-edit]$ ./setjava8andgradle.sh</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ source setjava8andgradle.sh</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ java -version</span><br><span class="line">java version &quot;1.8.0_60&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_60-b27)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)</span><br><span class="line">[qinxue@nc060 fanyi-edit]$ gradle -v</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Gradle 4.6</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Build time:   2018-02-28 13:36:36 UTC</span><br><span class="line">Revision:     8fa6ce7945b640e6168488e4417f9bb96e4ab46c</span><br><span class="line"></span><br><span class="line">Groovy:       2.4.12</span><br><span class="line">Ant:          Apache Ant(TM) version 1.9.9 compiled on February 2 2017</span><br><span class="line">JVM:          1.8.0_60 (Oracle Corporation 25.60-b23)</span><br><span class="line">OS:           Linux 2.6.32-642.el6.x86_64 amd64</span><br><span class="line"></span><br><span class="line">[qinxue@nc060 fanyi-edit]$</span><br></pre></td></tr></table></figure>
<h4 id="9-18"><a href="#9-18" class="headerlink" title="9-18"></a>9-18</h4><p>好久没有记笔记了，要知道自己的目标是什么。</p>
<p>当下我的目标是</p>
<ol>
<li>申请转正答辩，并好好准备</li>
<li>把剩下的业务做完</li>
<li>与老板一起改小论文，发表出去</li>
<li>后面就可以做自己想做的事情了（过年之前）</li>
<li>同时要意识到，很多事情是可以同步进行的</li>
</ol>
<p>做任何事情，都要讲究目的，没有目的的漫无边际是低效率的。当然你可以做一些长期才能看到效果的事情，但是少数。</p>
<p>永远做最重要的事情，并同时花少量时间持续地做应该做的、对自己长期有好处的事情。</p>
<p>9.27</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;com.hts.storage.ITerminologyStorage&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sql id=&quot;terminologyColumns&quot;&gt;</span><br><span class="line">        t.id as termId,</span><br><span class="line">        t.userId,</span><br><span class="line">        t.htsOrderId,</span><br><span class="line">        t.providerId,</span><br><span class="line">        t.srcLang,</span><br><span class="line">        t.desLang,</span><br><span class="line">        t.srcTerm,</span><br><span class="line">        t.desTerm,</span><br><span class="line">        t.sourceFrom,</span><br><span class="line">        t.createTime,</span><br><span class="line">        t.updateId,</span><br><span class="line">        t.updateTime,</span><br><span class="line">        t.reviewerId,</span><br><span class="line">        t.status,</span><br><span class="line">        f.id as fieldId,</span><br><span class="line">        f.name as fieldName</span><br><span class="line">    &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sql id=&quot;terminologyJoins&quot;&gt;</span><br><span class="line">        left outer join cat_terminology_field_x as tf on tf.termId = t.id</span><br><span class="line">        left outer join cat_field_x as f on tf.fieldId = f.id</span><br><span class="line">    &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=&quot;termResultMap&quot; type=&quot;com.hts.model.Terminology&quot;&gt;</span><br><span class="line">        &lt;!-- 类Terminology中必须要有包含一个参数的构造函数，参数为id，即主键名 --&gt;</span><br><span class="line">        &lt;constructor&gt;</span><br><span class="line">            &lt;idArg column=&quot;termId&quot; javaType=&quot;long&quot;/&gt;</span><br><span class="line">        &lt;/constructor&gt;</span><br><span class="line">        &lt;result property=&quot;userId&quot; column=&quot;userId&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;htsOrderId&quot; column=&quot;htsOrderId&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;providerId&quot; column=&quot;providerId&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;srcLang&quot; column=&quot;srcLang&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;desLang&quot; column=&quot;desLang&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;srcTerm&quot; column=&quot;srcTerm&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;desTerm&quot; column=&quot;desTerm&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;sourceFrom&quot; column=&quot;sourceFrom&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;createTime&quot; column=&quot;createTime&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;updateId&quot; column=&quot;updateId&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;updateTime&quot; column=&quot;updateTime&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;reviewerId&quot; column=&quot;reviewerId&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;status&quot; column=&quot;status&quot;/&gt;</span><br><span class="line">        &lt;collection property=&quot;fields&quot; ofType=&quot;com.hts.model.Field&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;fieldId&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;name&quot; column=&quot;fieldName&quot;/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 添加一条术语 --&gt;</span><br><span class="line">    &lt;insert id=&quot;addTerminology&quot; statementType=&quot;PREPARED&quot; parameterType=&quot;com.hts.model.Terminology&quot; keyProperty=&quot;id&quot;&gt;</span><br><span class="line">        INSERT INTO terminology (</span><br><span class="line">            htsOrderId,</span><br><span class="line">            userId,</span><br><span class="line">            providerId,</span><br><span class="line">            srcLang,</span><br><span class="line">            desLang,</span><br><span class="line">            srcTerm,</span><br><span class="line">            desTerm,</span><br><span class="line">            sourceFrom,</span><br><span class="line">            createTime,</span><br><span class="line">            updateId,</span><br><span class="line">            updateTime,</span><br><span class="line">            reviewerId,</span><br><span class="line">            status</span><br><span class="line">        ) VALUES (</span><br><span class="line">            #&#123;htsOrderId&#125;,</span><br><span class="line">            #&#123;userId&#125;,</span><br><span class="line">            #&#123;providerId&#125;,</span><br><span class="line">            #&#123;srcLang&#125;,</span><br><span class="line">            #&#123;desLang&#125;,</span><br><span class="line">            #&#123;srcTerm&#125;,</span><br><span class="line">            #&#123;desTerm&#125;,</span><br><span class="line">            #&#123;sourceFrom&#125;,</span><br><span class="line">            #&#123;createTime&#125;,</span><br><span class="line">            #&#123;updateId&#125;,</span><br><span class="line">            #&#123;updateTime&#125;,</span><br><span class="line">            #&#123;reviewerId&#125;,</span><br><span class="line">            #&#123;status&#125;</span><br><span class="line">        )</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getTermsListSize&quot; resultType=&quot;long&quot;&gt;</span><br><span class="line">        select count(id) from terminology</span><br><span class="line">        WHERE status &gt;= 0</span><br><span class="line">        &lt;if test=&quot;id != null and id != &apos;&apos;&quot;&gt;</span><br><span class="line">            AND id = #&#123;id&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;userId != null and userId != &apos;&apos;&quot;&gt;</span><br><span class="line">            AND userId = #&#123;userId&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;htsOrderId != null and htsOrderId != &apos;&apos;&quot;&gt;</span><br><span class="line">            AND htsOrderId = #&#123;htsOrderId&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;srcLang != null and srcLang != &apos;&apos;&quot;&gt;</span><br><span class="line">            AND srcLang = #&#123;srcLang&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;desLang != null and desLang != &apos;&apos;&quot;&gt;</span><br><span class="line">            AND desLang = #&#123;desLang&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        ORDER BY updateTime DESC, createTime DESC</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getTermsList2&quot; resultMap=&quot;termResultMap&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">        &lt;include refid=&quot;terminologyColumns&quot;/&gt;</span><br><span class="line">        from (</span><br><span class="line">            select *</span><br><span class="line">            from terminology</span><br><span class="line">            WHERE status &gt;= 0</span><br><span class="line">            &lt;if test=&quot;id != null and id != &apos;&apos;&quot;&gt;</span><br><span class="line">                AND id = #&#123;id&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;userId != null and userId != &apos;&apos;&quot;&gt;</span><br><span class="line">                AND userId = #&#123;userId&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;htsOrderId != null and htsOrderId != &apos;&apos;&quot;&gt;</span><br><span class="line">                AND htsOrderId = #&#123;htsOrderId&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;srcLang != null and srcLang != &apos;&apos;&quot;&gt;</span><br><span class="line">                AND srcLang = #&#123;srcLang&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;desLang != null and desLang != &apos;&apos;&quot;&gt;</span><br><span class="line">                AND desLang = #&#123;desLang&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            ORDER BY updateTime DESC, createTime DESC</span><br><span class="line">            limit #&#123;pageSize&#125; offset #&#123;offSetNum&#125;) t</span><br><span class="line">        &lt;include refid=&quot;terminologyJoins&quot;/&gt;</span><br><span class="line">        WHERE tf.status &gt;= 0</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@ApiOperation(value = &quot;根据人工翻译订单号查询所有术语&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/getTermsByOrderId2&quot;, method = RequestMethod.GET)</span><br><span class="line">public JSONObject getTermsByOrderId2(@ApiParam(value = &quot;订单号&quot;) @RequestParam(&quot;orderId&quot;) long orderId,</span><br><span class="line">                                     @ApiParam(value = &quot;开始页数，默认为1&quot;) @RequestParam(value = &quot;pageIndex&quot;, required = false, defaultValue = &quot;1&quot;) int pageIndex) &#123;</span><br><span class="line">    Terminology terminology = new Terminology();</span><br><span class="line">    terminology.setHtsOrderId(orderId);</span><br><span class="line">    // 获取总大小</span><br><span class="line">    long termsNum = terminologyStorage.getTermsListSize(terminology);</span><br><span class="line">    terminology.setPageSize(PAGE_SIZE);</span><br><span class="line">    terminology.setOffSetNum((pageIndex - 1) * PAGE_SIZE);</span><br><span class="line">    List&lt;Terminology&gt; terminologyList = terminologyStorage.getTermsList2(terminology);</span><br><span class="line">    JSONObject result = ResponseUtils.createResponse(IResponseStatus.STATUS_VALID, terminologyList);</span><br><span class="line">    result.put(&quot;currentPageIndex&quot;, pageIndex);</span><br><span class="line">    result.put(&quot;totalPages&quot;, termsNum / PAGE_SIZE + 1);</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于一对多查询时分页出现的问题，核心的问题是mybatis在进行分页时，动态地加上了limit和offset，但是它是直接加在了sql语句的最后面。所以解决方案之一是，依然采用连表查询，只不过手动地把limit/offset放到主查询的后面。连表join放在最后面。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select t.*,</span><br><span class="line">f.id as fieldId,</span><br><span class="line">f.name as fieldName</span><br><span class="line">from (select * from terminology where htsOrderId = 123244234241 and status &gt;= 0 ORDER BY updateTime DESC, createTime DESC limit 20 offset 0) t</span><br><span class="line">left outer join cat_terminology_field_x as tf on tf.termId = t.id</span><br><span class="line">left outer join cat_field_x as f on tf.fieldId = f.id</span><br><span class="line">and tf.status &gt;= 0</span><br></pre></td></tr></table></figure>
<p>这样的缺点是，不能用到mybatis自带的PageHelper插件了。所以limit/offset要计算好，手动写入。</p>
<p>第二种解决方案是：不采用连表查询，这样PageHelper插件还是可以用。只不过，其它表的信息需要单独查询，再把查询结果放入主对象（比如主要查询术语，那么主对象就是Terminology）中。最后选择了这种方式，虽然查询的次数多了（有点N+1问题的味道），但是解耦了，而且方便，可以直接套用PageHelper。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package com.hts.model;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line">import com.hts.common.helper.LongToStringSerializer;</span><br><span class="line">import com.hts.model.interfaces.ITerm;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Terminology implements ITerm, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private long id;</span><br><span class="line">    private long htsOrderId;</span><br><span class="line"></span><br><span class="line">    @JSONField(serializeUsing = LongToStringSerializer.class)</span><br><span class="line">    private long userId;</span><br><span class="line"></span><br><span class="line">    @JSONField(serializeUsing = LongToStringSerializer.class)</span><br><span class="line">    private long providerId;</span><br><span class="line"></span><br><span class="line">    private String srcLang;</span><br><span class="line">    private String desLang;</span><br><span class="line">    private String srcTerm;</span><br><span class="line">    private String desTerm;</span><br><span class="line"></span><br><span class="line">    @JSONField(serialize = false)</span><br><span class="line">    private int sourceFrom;</span><br><span class="line"></span><br><span class="line">    @JSONField(serialize = false)</span><br><span class="line">    private long createTime;</span><br><span class="line"></span><br><span class="line">    @JSONField(serializeUsing = LongToStringSerializer.class)</span><br><span class="line">    private long updateId;</span><br><span class="line"></span><br><span class="line">    private long updateTime;</span><br><span class="line"></span><br><span class="line">    @JSONField(serializeUsing = LongToStringSerializer.class)</span><br><span class="line">    private long reviewerId;</span><br><span class="line"></span><br><span class="line">    @JSONField(serialize = false)</span><br><span class="line">    private int status;</span><br><span class="line"></span><br><span class="line">    // 重点在这个地方，额外查询的结果放入这个地方</span><br><span class="line">    private List&lt;TermField&gt; termFields;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 空构造</span><br><span class="line">     * mybatis需要</span><br><span class="line">     */</span><br><span class="line">    public Terminology() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 其它构造函数、getter、setter略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后来参考博客<a href="https://blog.csdn.net/u013887008/article/details/80382764" target="_blank" rel="noopener">mybatis中使用pageHelper实现一对多分页</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.youdao.mapper.GoodsMapper&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=&quot;GoodsMap&quot; type=&quot;com.youdao.entity.Goods&quot;&gt;</span><br><span class="line">        &lt;constructor&gt;</span><br><span class="line">            &lt;idArg column=&quot;id&quot; javaType=&quot;long&quot;/&gt;</span><br><span class="line">        &lt;/constructor&gt;</span><br><span class="line">        &lt;result property=&quot;goodsName&quot; column=&quot;goods_name&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;goodsTitle&quot; column=&quot;goods_title&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;goodsImg&quot; column=&quot;goods_img&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;goodsDetail&quot; column=&quot;goods_detail&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;goodsPrice&quot; column=&quot;goods_price&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;goodsStock&quot; column=&quot;goods_stock&quot;/&gt;</span><br><span class="line">        &lt;collection property=&quot;fieldList&quot; column=&quot;id&quot; ofType=&quot;com.youdao.entity.Field&quot; select=&quot;getFieldByGoodsId&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;fieldId&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;name&quot; column=&quot;fieldName&quot;/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--&lt;collection property=&quot;fieldList&quot; ofType=&quot;com.youdao.entity.Field&quot;&gt;--&gt;</span><br><span class="line">            &lt;!--&lt;id property=&quot;id&quot; column=&quot;fieldId&quot;/&gt;--&gt;</span><br><span class="line">            &lt;!--&lt;result property=&quot;name&quot; column=&quot;fieldName&quot;/&gt;--&gt;</span><br><span class="line">        &lt;!--&lt;/collection&gt;--&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getFieldByGoodsId&quot; parameterType=&quot;long&quot; resultType=&quot;com.youdao.entity.Field&quot;&gt;</span><br><span class="line">            select f.id, f.name from goods_field as gf</span><br><span class="line">            left join field as f on f.id = gf.field_id</span><br><span class="line">            where gf.goods_id = #&#123;goods_id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getAll&quot; resultMap=&quot;GoodsMap&quot;&gt;</span><br><span class="line">--         SELECT g.*, f.id as fieldId, f.name as fieldName FROM goods as g</span><br><span class="line">--         left join goods_field as gf on g.id = gf.goods_id</span><br><span class="line">--         left join field as f on f.id = gf.field_id</span><br><span class="line">            SELECT g.* FROM goods as g</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<p>这里使用了另外一种方法，既能够直接使用连表查询，避免1+N查询问题，还能直接使用Page插件！！</p>
<p>关于java中的弱引用：<a href="http://www.importnew.com/21206.html" target="_blank" rel="noopener">http://www.importnew.com/21206.html</a></p>
<p>Thread Local的详解：<a href="http://www.jasongj.com/java/threadlocal/" target="_blank" rel="noopener">http://www.jasongj.com/java/threadlocal/</a></p>
<p>关键点：线程间隔离，方法间共享</p>
<h4 id="10-8"><a href="#10-8" class="headerlink" title="10-8"></a>10-8</h4><p>一个resin对应一个port，每次重启的时候，会覆盖掉其他的启动目录。比如ds，有ds1，ds2，ds3，里面配置文件一样的，只是分支不同，当启动ds1时，如果ds2/ds3运行着，会覆盖掉。所以不用改配置文件变端口号。</p>
<h4 id="10-23"><a href="#10-23" class="headerlink" title="10-23"></a>10-23</h4><p>最后几天了</p>
<p>这些天的任务：</p>
<p>1.多看<a href="http://ks.netease.com/blog?id=3100" target="_blank" rel="noopener">http://ks.netease.com/blog?id=3100</a>网易实践者社区里面的文章</p>
<p>2.总结整个官网、分单系统、cat系统等项目的框架与代码，挖掘到底</p>
<p>3.做交接任务</p>
<p>1.官网某些页面用到了ExtJS</p>
<p>2.有需要写shell脚本的地方，需要熟练使用常见的shell脚本</p>
<p>3.大量的vm页面</p>
<p>4.dubbo配置中，zookeeper线上一个主节点，4个后备节点</p>
<p>5.对于多个系统都需要重复利用的功能，写进单独的项目里面，然后打包，供其它系统使用（例如hts-component）</p>
<p>6.有些对精确度比较高的变量，可以使用BigDecimal</p>
<p>7.发信息、邮件等组件可以单独写进一个项目供其它系统使用</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/总结/" rel="tag"># 总结</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/06/学车相关/" rel="next" title="学车相关">
                <i class="fa fa-chevron-left"></i> 学车相关
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">qin xue</p>
              <p class="site-description motion-element" itemprop="description">现在就要幸福</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">72</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/qxconverse" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:xqconver@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/qxconverse/" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#2018网易实习总结"><span class="nav-number">1.</span> <span class="nav-text">2018网易实习总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-21"><span class="nav-number">1.1.</span> <span class="nav-text">6-21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-22"><span class="nav-number">1.2.</span> <span class="nav-text">6-22</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-23"><span class="nav-number">1.3.</span> <span class="nav-text">6-23</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-25"><span class="nav-number">1.4.</span> <span class="nav-text">6-25</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-26"><span class="nav-number">1.5.</span> <span class="nav-text">6-26</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-27"><span class="nav-number">1.6.</span> <span class="nav-text">6-27</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-28"><span class="nav-number">1.7.</span> <span class="nav-text">6-28</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-29"><span class="nav-number">1.8.</span> <span class="nav-text">6-29</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-30"><span class="nav-number">1.9.</span> <span class="nav-text">6-30</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2（mac连接linux）"><span class="nav-number">1.10.</span> <span class="nav-text">7-2（mac连接linux）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3"><span class="nav-number">1.11.</span> <span class="nav-text">7-3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4"><span class="nav-number">1.12.</span> <span class="nav-text">7-4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5"><span class="nav-number">1.13.</span> <span class="nav-text">7-5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-6"><span class="nav-number">1.14.</span> <span class="nav-text">7-6</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-9"><span class="nav-number">1.15.</span> <span class="nav-text">7-9</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-10"><span class="nav-number">1.16.</span> <span class="nav-text">7-10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-11"><span class="nav-number">1.17.</span> <span class="nav-text">7-11</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-12"><span class="nav-number">1.18.</span> <span class="nav-text">7-12</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-13"><span class="nav-number">1.19.</span> <span class="nav-text">7-13</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-14"><span class="nav-number">1.20.</span> <span class="nav-text">7-14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-18"><span class="nav-number">1.21.</span> <span class="nav-text">7-18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-20"><span class="nav-number">1.22.</span> <span class="nav-text">7-20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-21"><span class="nav-number">1.23.</span> <span class="nav-text">7-21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-23（上线操作）"><span class="nav-number">1.24.</span> <span class="nav-text">7-23（上线操作）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-24"><span class="nav-number">1.25.</span> <span class="nav-text">7-24</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-26"><span class="nav-number">1.26.</span> <span class="nav-text">7-26</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-27"><span class="nav-number">1.27.</span> <span class="nav-text">7-27</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-28"><span class="nav-number">1.28.</span> <span class="nav-text">7-28</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-31"><span class="nav-number">1.29.</span> <span class="nav-text">7-31</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1"><span class="nav-number">1.30.</span> <span class="nav-text">8-1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2"><span class="nav-number">1.31.</span> <span class="nav-text">8-2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3"><span class="nav-number">1.32.</span> <span class="nav-text">8-3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-8"><span class="nav-number">1.33.</span> <span class="nav-text">8-8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-9"><span class="nav-number">1.34.</span> <span class="nav-text">8-9</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-10"><span class="nav-number">1.35.</span> <span class="nav-text">8-10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-13（Ribbon）"><span class="nav-number">1.36.</span> <span class="nav-text">8-13（Ribbon）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-14"><span class="nav-number">1.37.</span> <span class="nav-text">8-14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-16"><span class="nav-number">1.38.</span> <span class="nav-text">8-16</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-17"><span class="nav-number">1.39.</span> <span class="nav-text">8-17</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-21"><span class="nav-number">1.40.</span> <span class="nav-text">8-21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-22"><span class="nav-number">1.41.</span> <span class="nav-text">8-22</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-29"><span class="nav-number">1.42.</span> <span class="nav-text">8-29</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-12"><span class="nav-number">1.43.</span> <span class="nav-text">9-12</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-18"><span class="nav-number">1.44.</span> <span class="nav-text">9-18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-8"><span class="nav-number">1.45.</span> <span class="nav-text">10-8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-23"><span class="nav-number">1.46.</span> <span class="nav-text">10-23</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qin xue</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  


  

  


</body>
</html>
